function We(r,e){return function(){return r.apply(e,arguments)}}const{toString:xt}=Object.prototype,{getPrototypeOf:we}=Object,{iterator:se,toStringTag:Xe}=Symbol,re=(r=>e=>{const t=xt.call(e);return r[t]||(r[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),x=r=>(r=r.toLowerCase(),e=>re(e)===r),ne=r=>e=>typeof e===r,{isArray:I}=Array,P=ne("undefined");function V(r){return r!==null&&!P(r)&&r.constructor!==null&&!P(r.constructor)&&C(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const Ge=x("ArrayBuffer");function Ft(r){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&Ge(r.buffer),e}const kt=ne("string"),C=ne("function"),Ze=ne("number"),_=r=>r!==null&&typeof r=="object",Mt=r=>r===!0||r===!1,G=r=>{if(re(r)!=="object")return!1;const e=we(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Xe in r)&&!(se in r)},Nt=r=>{if(!_(r)||V(r))return!1;try{return Object.keys(r).length===0&&Object.getPrototypeOf(r)===Object.prototype}catch{return!1}},Rt=x("Date"),Bt=x("File"),Lt=x("Blob"),Dt=x("FileList"),It=r=>_(r)&&C(r.pipe),jt=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||C(r.append)&&((e=re(r))==="formdata"||e==="object"&&C(r.toString)&&r.toString()==="[object FormData]"))},Kt=x("URLSearchParams"),[Pt,$t,Vt,_t]=["ReadableStream","Request","Response","Headers"].map(x),Ut=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function U(r,e,{allOwnKeys:t=!1}={}){if(r===null||typeof r>"u")return;let s,n;if(typeof r!="object"&&(r=[r]),I(r))for(s=0,n=r.length;s<n;s++)e.call(null,r[s],s,r);else{if(V(r))return;const i=t?Object.getOwnPropertyNames(r):Object.keys(r),o=i.length;let c;for(s=0;s<o;s++)c=i[s],e.call(null,r[c],c,r)}}function Qe(r,e){if(V(r))return null;e=e.toLowerCase();const t=Object.keys(r);let s=t.length,n;for(;s-- >0;)if(n=t[s],e===n.toLowerCase())return n;return null}const R=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Ye=r=>!P(r)&&r!==R;function he(){const{caseless:r}=Ye(this)&&this||{},e={},t=(s,n)=>{const i=r&&Qe(e,n)||n;G(e[i])&&G(s)?e[i]=he(e[i],s):G(s)?e[i]=he({},s):I(s)?e[i]=s.slice():e[i]=s};for(let s=0,n=arguments.length;s<n;s++)arguments[s]&&U(arguments[s],t);return e}const Ht=(r,e,t,{allOwnKeys:s}={})=>(U(e,(n,i)=>{t&&C(n)?r[i]=We(n,t):r[i]=n},{allOwnKeys:s}),r),qt=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),zt=(r,e,t,s)=>{r.prototype=Object.create(e.prototype,s),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),t&&Object.assign(r.prototype,t)},Jt=(r,e,t,s)=>{let n,i,o;const c={};if(e=e||{},r==null)return e;do{for(n=Object.getOwnPropertyNames(r),i=n.length;i-- >0;)o=n[i],(!s||s(o,r,e))&&!c[o]&&(e[o]=r[o],c[o]=!0);r=t!==!1&&we(r)}while(r&&(!t||t(r,e))&&r!==Object.prototype);return e},Wt=(r,e,t)=>{r=String(r),(t===void 0||t>r.length)&&(t=r.length),t-=e.length;const s=r.indexOf(e,t);return s!==-1&&s===t},Xt=r=>{if(!r)return null;if(I(r))return r;let e=r.length;if(!Ze(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=r[e];return t},Gt=(r=>e=>r&&e instanceof r)(typeof Uint8Array<"u"&&we(Uint8Array)),Zt=(r,e)=>{const s=(r&&r[se]).call(r);let n;for(;(n=s.next())&&!n.done;){const i=n.value;e.call(r,i[0],i[1])}},Qt=(r,e)=>{let t;const s=[];for(;(t=r.exec(e))!==null;)s.push(t);return s},Yt=x("HTMLFormElement"),es=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,s,n){return s.toUpperCase()+n}),Se=(({hasOwnProperty:r})=>(e,t)=>r.call(e,t))(Object.prototype),ts=x("RegExp"),et=(r,e)=>{const t=Object.getOwnPropertyDescriptors(r),s={};U(t,(n,i)=>{let o;(o=e(n,i,r))!==!1&&(s[i]=o||n)}),Object.defineProperties(r,s)},ss=r=>{et(r,(e,t)=>{if(C(r)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const s=r[t];if(C(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},rs=(r,e)=>{const t={},s=n=>{n.forEach(i=>{t[i]=!0})};return I(r)?s(r):s(String(r).split(e)),t},ns=()=>{},is=(r,e)=>r!=null&&Number.isFinite(r=+r)?r:e;function os(r){return!!(r&&C(r.append)&&r[Xe]==="FormData"&&r[se])}const as=r=>{const e=new Array(10),t=(s,n)=>{if(_(s)){if(e.indexOf(s)>=0)return;if(V(s))return s;if(!("toJSON"in s)){e[n]=s;const i=I(s)?[]:{};return U(s,(o,c)=>{const h=t(o,n+1);!P(h)&&(i[c]=h)}),e[n]=void 0,i}}return s};return t(r,0)},cs=x("AsyncFunction"),ls=r=>r&&(_(r)||C(r))&&C(r.then)&&C(r.catch),tt=((r,e)=>r?setImmediate:e?((t,s)=>(R.addEventListener("message",({source:n,data:i})=>{n===R&&i===t&&s.length&&s.shift()()},!1),n=>{s.push(n),R.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",C(R.postMessage)),us=typeof queueMicrotask<"u"?queueMicrotask.bind(R):typeof process<"u"&&process.nextTick||tt,hs=r=>r!=null&&C(r[se]),a={isArray:I,isArrayBuffer:Ge,isBuffer:V,isFormData:jt,isArrayBufferView:Ft,isString:kt,isNumber:Ze,isBoolean:Mt,isObject:_,isPlainObject:G,isEmptyObject:Nt,isReadableStream:Pt,isRequest:$t,isResponse:Vt,isHeaders:_t,isUndefined:P,isDate:Rt,isFile:Bt,isBlob:Lt,isRegExp:ts,isFunction:C,isStream:It,isURLSearchParams:Kt,isTypedArray:Gt,isFileList:Dt,forEach:U,merge:he,extend:Ht,trim:Ut,stripBOM:qt,inherits:zt,toFlatObject:Jt,kindOf:re,kindOfTest:x,endsWith:Wt,toArray:Xt,forEachEntry:Zt,matchAll:Qt,isHTMLForm:Yt,hasOwnProperty:Se,hasOwnProp:Se,reduceDescriptors:et,freezeMethods:ss,toObjectSet:rs,toCamelCase:es,noop:ns,toFiniteNumber:is,findKey:Qe,global:R,isContextDefined:Ye,isSpecCompliantForm:os,toJSONObject:as,isAsyncFn:cs,isThenable:ls,setImmediate:tt,asap:us,isIterable:hs};function m(r,e,t,s,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),s&&(this.request=s),n&&(this.response=n,this.status=n.status?n.status:null)}a.inherits(m,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:a.toJSONObject(this.config),code:this.code,status:this.status}}});const st=m.prototype,rt={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{rt[r]={value:r}});Object.defineProperties(m,rt);Object.defineProperty(st,"isAxiosError",{value:!0});m.from=(r,e,t,s,n,i)=>{const o=Object.create(st);return a.toFlatObject(r,o,function(h){return h!==Error.prototype},c=>c!=="isAxiosError"),m.call(o,r.message,e,t,s,n),o.cause=r,o.name=r.name,i&&Object.assign(o,i),o};const ds=null;function de(r){return a.isPlainObject(r)||a.isArray(r)}function nt(r){return a.endsWith(r,"[]")?r.slice(0,-2):r}function xe(r,e,t){return r?r.concat(e).map(function(n,i){return n=nt(n),!t&&i?"["+n+"]":n}).join(t?".":""):e}function fs(r){return a.isArray(r)&&!r.some(de)}const ps=a.toFlatObject(a,{},null,function(e){return/^is[A-Z]/.test(e)});function ie(r,e,t){if(!a.isObject(r))throw new TypeError("target must be an object");e=e||new FormData,t=a.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,p){return!a.isUndefined(p[g])});const s=t.metaTokens,n=t.visitor||u,i=t.dots,o=t.indexes,h=(t.Blob||typeof Blob<"u"&&Blob)&&a.isSpecCompliantForm(e);if(!a.isFunction(n))throw new TypeError("visitor must be a function");function l(f){if(f===null)return"";if(a.isDate(f))return f.toISOString();if(a.isBoolean(f))return f.toString();if(!h&&a.isBlob(f))throw new m("Blob is not supported. Use a Buffer instead.");return a.isArrayBuffer(f)||a.isTypedArray(f)?h&&typeof Blob=="function"?new Blob([f]):Buffer.from(f):f}function u(f,g,p){let b=f;if(f&&!p&&typeof f=="object"){if(a.endsWith(g,"{}"))g=s?g:g.slice(0,-2),f=JSON.stringify(f);else if(a.isArray(f)&&fs(f)||(a.isFileList(f)||a.endsWith(g,"[]"))&&(b=a.toArray(f)))return g=nt(g),b.forEach(function(O,k){!(a.isUndefined(O)||O===null)&&e.append(o===!0?xe([g],k,i):o===null?g:g+"[]",l(O))}),!1}return de(f)?!0:(e.append(xe(p,g,i),l(f)),!1)}const d=[],y=Object.assign(ps,{defaultVisitor:u,convertValue:l,isVisitable:de});function w(f,g){if(!a.isUndefined(f)){if(d.indexOf(f)!==-1)throw Error("Circular reference detected in "+g.join("."));d.push(f),a.forEach(f,function(b,E){(!(a.isUndefined(b)||b===null)&&n.call(e,b,a.isString(E)?E.trim():E,g,y))===!0&&w(b,g?g.concat(E):[E])}),d.pop()}}if(!a.isObject(r))throw new TypeError("data must be an object");return w(r),e}function Fe(r){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function Ee(r,e){this._pairs=[],r&&ie(r,this,e)}const it=Ee.prototype;it.append=function(e,t){this._pairs.push([e,t])};it.toString=function(e){const t=e?function(s){return e.call(this,s,Fe)}:Fe;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};function ms(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function ot(r,e,t){if(!e)return r;const s=t&&t.encode||ms;a.isFunction(t)&&(t={serialize:t});const n=t&&t.serialize;let i;if(n?i=n(e,t):i=a.isURLSearchParams(e)?e.toString():new Ee(e,t).toString(s),i){const o=r.indexOf("#");o!==-1&&(r=r.slice(0,o)),r+=(r.indexOf("?")===-1?"?":"&")+i}return r}class ke{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){a.forEach(this.handlers,function(s){s!==null&&e(s)})}}const at={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},gs=typeof URLSearchParams<"u"?URLSearchParams:Ee,ys=typeof FormData<"u"?FormData:null,bs=typeof Blob<"u"?Blob:null,vs={isBrowser:!0,classes:{URLSearchParams:gs,FormData:ys,Blob:bs},protocols:["http","https","file","blob","url","data"]},Oe=typeof window<"u"&&typeof document<"u",fe=typeof navigator=="object"&&navigator||void 0,ws=Oe&&(!fe||["ReactNative","NativeScript","NS"].indexOf(fe.product)<0),Es=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Os=Oe&&window.location.href||"http://localhost",As=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Oe,hasStandardBrowserEnv:ws,hasStandardBrowserWebWorkerEnv:Es,navigator:fe,origin:Os},Symbol.toStringTag,{value:"Module"})),A={...As,...vs};function Ts(r,e){return ie(r,new A.classes.URLSearchParams,{visitor:function(t,s,n,i){return A.isNode&&a.isBuffer(t)?(this.append(s,t.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)},...e})}function Cs(r){return a.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Ss(r){const e={},t=Object.keys(r);let s;const n=t.length;let i;for(s=0;s<n;s++)i=t[s],e[i]=r[i];return e}function ct(r){function e(t,s,n,i){let o=t[i++];if(o==="__proto__")return!0;const c=Number.isFinite(+o),h=i>=t.length;return o=!o&&a.isArray(n)?n.length:o,h?(a.hasOwnProp(n,o)?n[o]=[n[o],s]:n[o]=s,!c):((!n[o]||!a.isObject(n[o]))&&(n[o]=[]),e(t,s,n[o],i)&&a.isArray(n[o])&&(n[o]=Ss(n[o])),!c)}if(a.isFormData(r)&&a.isFunction(r.entries)){const t={};return a.forEachEntry(r,(s,n)=>{e(Cs(s),n,t,0)}),t}return null}function xs(r,e,t){if(a.isString(r))try{return(e||JSON.parse)(r),a.trim(r)}catch(s){if(s.name!=="SyntaxError")throw s}return(t||JSON.stringify)(r)}const H={transitional:at,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const s=t.getContentType()||"",n=s.indexOf("application/json")>-1,i=a.isObject(e);if(i&&a.isHTMLForm(e)&&(e=new FormData(e)),a.isFormData(e))return n?JSON.stringify(ct(e)):e;if(a.isArrayBuffer(e)||a.isBuffer(e)||a.isStream(e)||a.isFile(e)||a.isBlob(e)||a.isReadableStream(e))return e;if(a.isArrayBufferView(e))return e.buffer;if(a.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let c;if(i){if(s.indexOf("application/x-www-form-urlencoded")>-1)return Ts(e,this.formSerializer).toString();if((c=a.isFileList(e))||s.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return ie(c?{"files[]":e}:e,h&&new h,this.formSerializer)}}return i||n?(t.setContentType("application/json",!1),xs(e)):e}],transformResponse:[function(e){const t=this.transitional||H.transitional,s=t&&t.forcedJSONParsing,n=this.responseType==="json";if(a.isResponse(e)||a.isReadableStream(e))return e;if(e&&a.isString(e)&&(s&&!this.responseType||n)){const o=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(c){if(o)throw c.name==="SyntaxError"?m.from(c,m.ERR_BAD_RESPONSE,this,null,this.response):c}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:A.classes.FormData,Blob:A.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};a.forEach(["delete","get","head","post","put","patch"],r=>{H.headers[r]={}});const Fs=a.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ks=r=>{const e={};let t,s,n;return r&&r.split(`
`).forEach(function(o){n=o.indexOf(":"),t=o.substring(0,n).trim().toLowerCase(),s=o.substring(n+1).trim(),!(!t||e[t]&&Fs[t])&&(t==="set-cookie"?e[t]?e[t].push(s):e[t]=[s]:e[t]=e[t]?e[t]+", "+s:s)}),e},Me=Symbol("internals");function K(r){return r&&String(r).trim().toLowerCase()}function Z(r){return r===!1||r==null?r:a.isArray(r)?r.map(Z):String(r)}function Ms(r){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=t.exec(r);)e[s[1]]=s[2];return e}const Ns=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function ce(r,e,t,s,n){if(a.isFunction(s))return s.call(this,e,t);if(n&&(e=t),!!a.isString(e)){if(a.isString(s))return e.indexOf(s)!==-1;if(a.isRegExp(s))return s.test(e)}}function Rs(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,s)=>t.toUpperCase()+s)}function Bs(r,e){const t=a.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(r,s+t,{value:function(n,i,o){return this[s].call(this,e,n,i,o)},configurable:!0})})}let S=class{constructor(e){e&&this.set(e)}set(e,t,s){const n=this;function i(c,h,l){const u=K(h);if(!u)throw new Error("header name must be a non-empty string");const d=a.findKey(n,u);(!d||n[d]===void 0||l===!0||l===void 0&&n[d]!==!1)&&(n[d||h]=Z(c))}const o=(c,h)=>a.forEach(c,(l,u)=>i(l,u,h));if(a.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(a.isString(e)&&(e=e.trim())&&!Ns(e))o(ks(e),t);else if(a.isObject(e)&&a.isIterable(e)){let c={},h,l;for(const u of e){if(!a.isArray(u))throw TypeError("Object iterator must return a key-value pair");c[l=u[0]]=(h=c[l])?a.isArray(h)?[...h,u[1]]:[h,u[1]]:u[1]}o(c,t)}else e!=null&&i(t,e,s);return this}get(e,t){if(e=K(e),e){const s=a.findKey(this,e);if(s){const n=this[s];if(!t)return n;if(t===!0)return Ms(n);if(a.isFunction(t))return t.call(this,n,s);if(a.isRegExp(t))return t.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=K(e),e){const s=a.findKey(this,e);return!!(s&&this[s]!==void 0&&(!t||ce(this,this[s],s,t)))}return!1}delete(e,t){const s=this;let n=!1;function i(o){if(o=K(o),o){const c=a.findKey(s,o);c&&(!t||ce(s,s[c],c,t))&&(delete s[c],n=!0)}}return a.isArray(e)?e.forEach(i):i(e),n}clear(e){const t=Object.keys(this);let s=t.length,n=!1;for(;s--;){const i=t[s];(!e||ce(this,this[i],i,e,!0))&&(delete this[i],n=!0)}return n}normalize(e){const t=this,s={};return a.forEach(this,(n,i)=>{const o=a.findKey(s,i);if(o){t[o]=Z(n),delete t[i];return}const c=e?Rs(i):String(i).trim();c!==i&&delete t[i],t[c]=Z(n),s[c]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return a.forEach(this,(s,n)=>{s!=null&&s!==!1&&(t[n]=e&&a.isArray(s)?s.join(", "):s)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const s=new this(e);return t.forEach(n=>s.set(n)),s}static accessor(e){const s=(this[Me]=this[Me]={accessors:{}}).accessors,n=this.prototype;function i(o){const c=K(o);s[c]||(Bs(n,o),s[c]=!0)}return a.isArray(e)?e.forEach(i):i(e),this}};S.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);a.reduceDescriptors(S.prototype,({value:r},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>r,set(s){this[t]=s}}});a.freezeMethods(S);function le(r,e){const t=this||H,s=e||t,n=S.from(s.headers);let i=s.data;return a.forEach(r,function(c){i=c.call(t,i,n.normalize(),e?e.status:void 0)}),n.normalize(),i}function lt(r){return!!(r&&r.__CANCEL__)}function j(r,e,t){m.call(this,r??"canceled",m.ERR_CANCELED,e,t),this.name="CanceledError"}a.inherits(j,m,{__CANCEL__:!0});function ut(r,e,t){const s=t.config.validateStatus;!t.status||!s||s(t.status)?r(t):e(new m("Request failed with status code "+t.status,[m.ERR_BAD_REQUEST,m.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function Ls(r){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}function Ds(r,e){r=r||10;const t=new Array(r),s=new Array(r);let n=0,i=0,o;return e=e!==void 0?e:1e3,function(h){const l=Date.now(),u=s[i];o||(o=l),t[n]=h,s[n]=l;let d=i,y=0;for(;d!==n;)y+=t[d++],d=d%r;if(n=(n+1)%r,n===i&&(i=(i+1)%r),l-o<e)return;const w=u&&l-u;return w?Math.round(y*1e3/w):void 0}}function Is(r,e){let t=0,s=1e3/e,n,i;const o=(l,u=Date.now())=>{t=u,n=null,i&&(clearTimeout(i),i=null),r(...l)};return[(...l)=>{const u=Date.now(),d=u-t;d>=s?o(l,u):(n=l,i||(i=setTimeout(()=>{i=null,o(n)},s-d)))},()=>n&&o(n)]}const Y=(r,e,t=3)=>{let s=0;const n=Ds(50,250);return Is(i=>{const o=i.loaded,c=i.lengthComputable?i.total:void 0,h=o-s,l=n(h),u=o<=c;s=o;const d={loaded:o,total:c,progress:c?o/c:void 0,bytes:h,rate:l||void 0,estimated:l&&c&&u?(c-o)/l:void 0,event:i,lengthComputable:c!=null,[e?"download":"upload"]:!0};r(d)},t)},Ne=(r,e)=>{const t=r!=null;return[s=>e[0]({lengthComputable:t,total:r,loaded:s}),e[1]]},Re=r=>(...e)=>a.asap(()=>r(...e)),js=A.hasStandardBrowserEnv?((r,e)=>t=>(t=new URL(t,A.origin),r.protocol===t.protocol&&r.host===t.host&&(e||r.port===t.port)))(new URL(A.origin),A.navigator&&/(msie|trident)/i.test(A.navigator.userAgent)):()=>!0,Ks=A.hasStandardBrowserEnv?{write(r,e,t,s,n,i){const o=[r+"="+encodeURIComponent(e)];a.isNumber(t)&&o.push("expires="+new Date(t).toGMTString()),a.isString(s)&&o.push("path="+s),a.isString(n)&&o.push("domain="+n),i===!0&&o.push("secure"),document.cookie=o.join("; ")},read(r){const e=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Ps(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function $s(r,e){return e?r.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):r}function ht(r,e,t){let s=!Ps(e);return r&&(s||t==!1)?$s(r,e):e}const Be=r=>r instanceof S?{...r}:r;function D(r,e){e=e||{};const t={};function s(l,u,d,y){return a.isPlainObject(l)&&a.isPlainObject(u)?a.merge.call({caseless:y},l,u):a.isPlainObject(u)?a.merge({},u):a.isArray(u)?u.slice():u}function n(l,u,d,y){if(a.isUndefined(u)){if(!a.isUndefined(l))return s(void 0,l,d,y)}else return s(l,u,d,y)}function i(l,u){if(!a.isUndefined(u))return s(void 0,u)}function o(l,u){if(a.isUndefined(u)){if(!a.isUndefined(l))return s(void 0,l)}else return s(void 0,u)}function c(l,u,d){if(d in e)return s(l,u);if(d in r)return s(void 0,l)}const h={url:i,method:i,data:i,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:c,headers:(l,u,d)=>n(Be(l),Be(u),d,!0)};return a.forEach(Object.keys({...r,...e}),function(u){const d=h[u]||n,y=d(r[u],e[u],u);a.isUndefined(y)&&d!==c||(t[u]=y)}),t}const dt=r=>{const e=D({},r);let{data:t,withXSRFToken:s,xsrfHeaderName:n,xsrfCookieName:i,headers:o,auth:c}=e;e.headers=o=S.from(o),e.url=ot(ht(e.baseURL,e.url,e.allowAbsoluteUrls),r.params,r.paramsSerializer),c&&o.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):"")));let h;if(a.isFormData(t)){if(A.hasStandardBrowserEnv||A.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((h=o.getContentType())!==!1){const[l,...u]=h?h.split(";").map(d=>d.trim()).filter(Boolean):[];o.setContentType([l||"multipart/form-data",...u].join("; "))}}if(A.hasStandardBrowserEnv&&(s&&a.isFunction(s)&&(s=s(e)),s||s!==!1&&js(e.url))){const l=n&&i&&Ks.read(i);l&&o.set(n,l)}return e},Vs=typeof XMLHttpRequest<"u",_s=Vs&&function(r){return new Promise(function(t,s){const n=dt(r);let i=n.data;const o=S.from(n.headers).normalize();let{responseType:c,onUploadProgress:h,onDownloadProgress:l}=n,u,d,y,w,f;function g(){w&&w(),f&&f(),n.cancelToken&&n.cancelToken.unsubscribe(u),n.signal&&n.signal.removeEventListener("abort",u)}let p=new XMLHttpRequest;p.open(n.method.toUpperCase(),n.url,!0),p.timeout=n.timeout;function b(){if(!p)return;const O=S.from("getAllResponseHeaders"in p&&p.getAllResponseHeaders()),T={data:!c||c==="text"||c==="json"?p.responseText:p.response,status:p.status,statusText:p.statusText,headers:O,config:r,request:p};ut(function(N){t(N),g()},function(N){s(N),g()},T),p=null}"onloadend"in p?p.onloadend=b:p.onreadystatechange=function(){!p||p.readyState!==4||p.status===0&&!(p.responseURL&&p.responseURL.indexOf("file:")===0)||setTimeout(b)},p.onabort=function(){p&&(s(new m("Request aborted",m.ECONNABORTED,r,p)),p=null)},p.onerror=function(){s(new m("Network Error",m.ERR_NETWORK,r,p)),p=null},p.ontimeout=function(){let k=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const T=n.transitional||at;n.timeoutErrorMessage&&(k=n.timeoutErrorMessage),s(new m(k,T.clarifyTimeoutError?m.ETIMEDOUT:m.ECONNABORTED,r,p)),p=null},i===void 0&&o.setContentType(null),"setRequestHeader"in p&&a.forEach(o.toJSON(),function(k,T){p.setRequestHeader(T,k)}),a.isUndefined(n.withCredentials)||(p.withCredentials=!!n.withCredentials),c&&c!=="json"&&(p.responseType=n.responseType),l&&([y,f]=Y(l,!0),p.addEventListener("progress",y)),h&&p.upload&&([d,w]=Y(h),p.upload.addEventListener("progress",d),p.upload.addEventListener("loadend",w)),(n.cancelToken||n.signal)&&(u=O=>{p&&(s(!O||O.type?new j(null,r,p):O),p.abort(),p=null)},n.cancelToken&&n.cancelToken.subscribe(u),n.signal&&(n.signal.aborted?u():n.signal.addEventListener("abort",u)));const E=Ls(n.url);if(E&&A.protocols.indexOf(E)===-1){s(new m("Unsupported protocol "+E+":",m.ERR_BAD_REQUEST,r));return}p.send(i||null)})},Us=(r,e)=>{const{length:t}=r=r?r.filter(Boolean):[];if(e||t){let s=new AbortController,n;const i=function(l){if(!n){n=!0,c();const u=l instanceof Error?l:this.reason;s.abort(u instanceof m?u:new j(u instanceof Error?u.message:u))}};let o=e&&setTimeout(()=>{o=null,i(new m(`timeout ${e} of ms exceeded`,m.ETIMEDOUT))},e);const c=()=>{r&&(o&&clearTimeout(o),o=null,r.forEach(l=>{l.unsubscribe?l.unsubscribe(i):l.removeEventListener("abort",i)}),r=null)};r.forEach(l=>l.addEventListener("abort",i));const{signal:h}=s;return h.unsubscribe=()=>a.asap(c),h}},Hs=function*(r,e){let t=r.byteLength;if(t<e){yield r;return}let s=0,n;for(;s<t;)n=s+e,yield r.slice(s,n),s=n},qs=async function*(r,e){for await(const t of zs(r))yield*Hs(t,e)},zs=async function*(r){if(r[Symbol.asyncIterator]){yield*r;return}const e=r.getReader();try{for(;;){const{done:t,value:s}=await e.read();if(t)break;yield s}}finally{await e.cancel()}},Le=(r,e,t,s)=>{const n=qs(r,e);let i=0,o,c=h=>{o||(o=!0,s&&s(h))};return new ReadableStream({async pull(h){try{const{done:l,value:u}=await n.next();if(l){c(),h.close();return}let d=u.byteLength;if(t){let y=i+=d;t(y)}h.enqueue(new Uint8Array(u))}catch(l){throw c(l),l}},cancel(h){return c(h),n.return()}},{highWaterMark:2})},oe=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",ft=oe&&typeof ReadableStream=="function",Js=oe&&(typeof TextEncoder=="function"?(r=>e=>r.encode(e))(new TextEncoder):async r=>new Uint8Array(await new Response(r).arrayBuffer())),pt=(r,...e)=>{try{return!!r(...e)}catch{return!1}},Ws=ft&&pt(()=>{let r=!1;const e=new Request(A.origin,{body:new ReadableStream,method:"POST",get duplex(){return r=!0,"half"}}).headers.has("Content-Type");return r&&!e}),De=64*1024,pe=ft&&pt(()=>a.isReadableStream(new Response("").body)),ee={stream:pe&&(r=>r.body)};oe&&(r=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!ee[e]&&(ee[e]=a.isFunction(r[e])?t=>t[e]():(t,s)=>{throw new m(`Response type '${e}' is not supported`,m.ERR_NOT_SUPPORT,s)})})})(new Response);const Xs=async r=>{if(r==null)return 0;if(a.isBlob(r))return r.size;if(a.isSpecCompliantForm(r))return(await new Request(A.origin,{method:"POST",body:r}).arrayBuffer()).byteLength;if(a.isArrayBufferView(r)||a.isArrayBuffer(r))return r.byteLength;if(a.isURLSearchParams(r)&&(r=r+""),a.isString(r))return(await Js(r)).byteLength},Gs=async(r,e)=>{const t=a.toFiniteNumber(r.getContentLength());return t??Xs(e)},Zs=oe&&(async r=>{let{url:e,method:t,data:s,signal:n,cancelToken:i,timeout:o,onDownloadProgress:c,onUploadProgress:h,responseType:l,headers:u,withCredentials:d="same-origin",fetchOptions:y}=dt(r);l=l?(l+"").toLowerCase():"text";let w=Us([n,i&&i.toAbortSignal()],o),f;const g=w&&w.unsubscribe&&(()=>{w.unsubscribe()});let p;try{if(h&&Ws&&t!=="get"&&t!=="head"&&(p=await Gs(u,s))!==0){let T=new Request(e,{method:"POST",body:s,duplex:"half"}),M;if(a.isFormData(s)&&(M=T.headers.get("content-type"))&&u.setContentType(M),T.body){const[N,W]=Ne(p,Y(Re(h)));s=Le(T.body,De,N,W)}}a.isString(d)||(d=d?"include":"omit");const b="credentials"in Request.prototype;f=new Request(e,{...y,signal:w,method:t.toUpperCase(),headers:u.normalize().toJSON(),body:s,duplex:"half",credentials:b?d:void 0});let E=await fetch(f,y);const O=pe&&(l==="stream"||l==="response");if(pe&&(c||O&&g)){const T={};["status","statusText","headers"].forEach(Ce=>{T[Ce]=E[Ce]});const M=a.toFiniteNumber(E.headers.get("content-length")),[N,W]=c&&Ne(M,Y(Re(c),!0))||[];E=new Response(Le(E.body,De,N,()=>{W&&W(),g&&g()}),T)}l=l||"text";let k=await ee[a.findKey(ee,l)||"text"](E,r);return!O&&g&&g(),await new Promise((T,M)=>{ut(T,M,{data:k,headers:S.from(E.headers),status:E.status,statusText:E.statusText,config:r,request:f})})}catch(b){throw g&&g(),b&&b.name==="TypeError"&&/Load failed|fetch/i.test(b.message)?Object.assign(new m("Network Error",m.ERR_NETWORK,r,f),{cause:b.cause||b}):m.from(b,b&&b.code,r,f)}}),me={http:ds,xhr:_s,fetch:Zs};a.forEach(me,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch{}Object.defineProperty(r,"adapterName",{value:e})}});const Ie=r=>`- ${r}`,Qs=r=>a.isFunction(r)||r===null||r===!1,mt={getAdapter:r=>{r=a.isArray(r)?r:[r];const{length:e}=r;let t,s;const n={};for(let i=0;i<e;i++){t=r[i];let o;if(s=t,!Qs(t)&&(s=me[(o=String(t)).toLowerCase()],s===void 0))throw new m(`Unknown adapter '${o}'`);if(s)break;n[o||"#"+i]=s}if(!s){const i=Object.entries(n).map(([c,h])=>`adapter ${c} `+(h===!1?"is not supported by the environment":"is not available in the build"));let o=e?i.length>1?`since :
`+i.map(Ie).join(`
`):" "+Ie(i[0]):"as no adapter specified";throw new m("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return s},adapters:me};function ue(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new j(null,r)}function je(r){return ue(r),r.headers=S.from(r.headers),r.data=le.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),mt.getAdapter(r.adapter||H.adapter)(r).then(function(s){return ue(r),s.data=le.call(r,r.transformResponse,s),s.headers=S.from(s.headers),s},function(s){return lt(s)||(ue(r),s&&s.response&&(s.response.data=le.call(r,r.transformResponse,s.response),s.response.headers=S.from(s.response.headers))),Promise.reject(s)})}const gt="1.11.0",ae={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{ae[r]=function(s){return typeof s===r||"a"+(e<1?"n ":" ")+r}});const Ke={};ae.transitional=function(e,t,s){function n(i,o){return"[Axios v"+gt+"] Transitional option '"+i+"'"+o+(s?". "+s:"")}return(i,o,c)=>{if(e===!1)throw new m(n(o," has been removed"+(t?" in "+t:"")),m.ERR_DEPRECATED);return t&&!Ke[o]&&(Ke[o]=!0,console.warn(n(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(i,o,c):!0}};ae.spelling=function(e){return(t,s)=>(console.warn(`${s} is likely a misspelling of ${e}`),!0)};function Ys(r,e,t){if(typeof r!="object")throw new m("options must be an object",m.ERR_BAD_OPTION_VALUE);const s=Object.keys(r);let n=s.length;for(;n-- >0;){const i=s[n],o=e[i];if(o){const c=r[i],h=c===void 0||o(c,i,r);if(h!==!0)throw new m("option "+i+" must be "+h,m.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new m("Unknown option "+i,m.ERR_BAD_OPTION)}}const Q={assertOptions:Ys,validators:ae},F=Q.validators;let B=class{constructor(e){this.defaults=e||{},this.interceptors={request:new ke,response:new ke}}async request(e,t){try{return await this._request(e,t)}catch(s){if(s instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const i=n.stack?n.stack.replace(/^.+\n/,""):"";try{s.stack?i&&!String(s.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+i):s.stack=i}catch{}}throw s}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=D(this.defaults,t);const{transitional:s,paramsSerializer:n,headers:i}=t;s!==void 0&&Q.assertOptions(s,{silentJSONParsing:F.transitional(F.boolean),forcedJSONParsing:F.transitional(F.boolean),clarifyTimeoutError:F.transitional(F.boolean)},!1),n!=null&&(a.isFunction(n)?t.paramsSerializer={serialize:n}:Q.assertOptions(n,{encode:F.function,serialize:F.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Q.assertOptions(t,{baseUrl:F.spelling("baseURL"),withXsrfToken:F.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=i&&a.merge(i.common,i[t.method]);i&&a.forEach(["delete","get","head","post","put","patch","common"],f=>{delete i[f]}),t.headers=S.concat(o,i);const c=[];let h=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(t)===!1||(h=h&&g.synchronous,c.unshift(g.fulfilled,g.rejected))});const l=[];this.interceptors.response.forEach(function(g){l.push(g.fulfilled,g.rejected)});let u,d=0,y;if(!h){const f=[je.bind(this),void 0];for(f.unshift(...c),f.push(...l),y=f.length,u=Promise.resolve(t);d<y;)u=u.then(f[d++],f[d++]);return u}y=c.length;let w=t;for(d=0;d<y;){const f=c[d++],g=c[d++];try{w=f(w)}catch(p){g.call(this,p);break}}try{u=je.call(this,w)}catch(f){return Promise.reject(f)}for(d=0,y=l.length;d<y;)u=u.then(l[d++],l[d++]);return u}getUri(e){e=D(this.defaults,e);const t=ht(e.baseURL,e.url,e.allowAbsoluteUrls);return ot(t,e.params,e.paramsSerializer)}};a.forEach(["delete","get","head","options"],function(e){B.prototype[e]=function(t,s){return this.request(D(s||{},{method:e,url:t,data:(s||{}).data}))}});a.forEach(["post","put","patch"],function(e){function t(s){return function(i,o,c){return this.request(D(c||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:i,data:o}))}}B.prototype[e]=t(),B.prototype[e+"Form"]=t(!0)});let er=class yt{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const s=this;this.promise.then(n=>{if(!s._listeners)return;let i=s._listeners.length;for(;i-- >0;)s._listeners[i](n);s._listeners=null}),this.promise.then=n=>{let i;const o=new Promise(c=>{s.subscribe(c),i=c}).then(n);return o.cancel=function(){s.unsubscribe(i)},o},e(function(i,o,c){s.reason||(s.reason=new j(i,o,c),t(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=s=>{e.abort(s)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new yt(function(n){e=n}),cancel:e}}};function tr(r){return function(t){return r.apply(null,t)}}function sr(r){return a.isObject(r)&&r.isAxiosError===!0}const ge={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ge).forEach(([r,e])=>{ge[e]=r});function bt(r){const e=new B(r),t=We(B.prototype.request,e);return a.extend(t,B.prototype,e,{allOwnKeys:!0}),a.extend(t,e,null,{allOwnKeys:!0}),t.create=function(n){return bt(D(r,n))},t}const v=bt(H);v.Axios=B;v.CanceledError=j;v.CancelToken=er;v.isCancel=lt;v.VERSION=gt;v.toFormData=ie;v.AxiosError=m;v.Cancel=v.CanceledError;v.all=function(e){return Promise.all(e)};v.spread=tr;v.isAxiosError=sr;v.mergeConfig=D;v.AxiosHeaders=S;v.formToJSON=r=>ct(a.isHTMLForm(r)?new FormData(r):r);v.getAdapter=mt.getAdapter;v.HttpStatusCode=ge;v.default=v;const{Axios:yn,AxiosError:bn,CanceledError:vn,isCancel:wn,CancelToken:En,VERSION:On,all:An,Cancel:Tn,isAxiosError:Cn,spread:Sn,toFormData:xn,AxiosHeaders:Fn,HttpStatusCode:kn,formToJSON:Mn,getAdapter:Nn,mergeConfig:Rn}=v;window.axios=v;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";class rr{constructor(e,t,s){this.eventTarget=e,this.eventName=t,this.eventOptions=s,this.unorderedBindings=new Set}connect(){this.eventTarget.addEventListener(this.eventName,this,this.eventOptions)}disconnect(){this.eventTarget.removeEventListener(this.eventName,this,this.eventOptions)}bindingConnected(e){this.unorderedBindings.add(e)}bindingDisconnected(e){this.unorderedBindings.delete(e)}handleEvent(e){const t=nr(e);for(const s of this.bindings){if(t.immediatePropagationStopped)break;s.handleEvent(t)}}hasBindings(){return this.unorderedBindings.size>0}get bindings(){return Array.from(this.unorderedBindings).sort((e,t)=>{const s=e.index,n=t.index;return s<n?-1:s>n?1:0})}}function nr(r){if("immediatePropagationStopped"in r)return r;{const{stopImmediatePropagation:e}=r;return Object.assign(r,{immediatePropagationStopped:!1,stopImmediatePropagation(){this.immediatePropagationStopped=!0,e.call(this)}})}}class ir{constructor(e){this.application=e,this.eventListenerMaps=new Map,this.started=!1}start(){this.started||(this.started=!0,this.eventListeners.forEach(e=>e.connect()))}stop(){this.started&&(this.started=!1,this.eventListeners.forEach(e=>e.disconnect()))}get eventListeners(){return Array.from(this.eventListenerMaps.values()).reduce((e,t)=>e.concat(Array.from(t.values())),[])}bindingConnected(e){this.fetchEventListenerForBinding(e).bindingConnected(e)}bindingDisconnected(e,t=!1){this.fetchEventListenerForBinding(e).bindingDisconnected(e),t&&this.clearEventListenersForBinding(e)}handleError(e,t,s={}){this.application.handleError(e,`Error ${t}`,s)}clearEventListenersForBinding(e){const t=this.fetchEventListenerForBinding(e);t.hasBindings()||(t.disconnect(),this.removeMappedEventListenerFor(e))}removeMappedEventListenerFor(e){const{eventTarget:t,eventName:s,eventOptions:n}=e,i=this.fetchEventListenerMapForEventTarget(t),o=this.cacheKey(s,n);i.delete(o),i.size==0&&this.eventListenerMaps.delete(t)}fetchEventListenerForBinding(e){const{eventTarget:t,eventName:s,eventOptions:n}=e;return this.fetchEventListener(t,s,n)}fetchEventListener(e,t,s){const n=this.fetchEventListenerMapForEventTarget(e),i=this.cacheKey(t,s);let o=n.get(i);return o||(o=this.createEventListener(e,t,s),n.set(i,o)),o}createEventListener(e,t,s){const n=new rr(e,t,s);return this.started&&n.connect(),n}fetchEventListenerMapForEventTarget(e){let t=this.eventListenerMaps.get(e);return t||(t=new Map,this.eventListenerMaps.set(e,t)),t}cacheKey(e,t){const s=[e];return Object.keys(t).sort().forEach(n=>{s.push(`${t[n]?"":"!"}${n}`)}),s.join(":")}}const or={stop({event:r,value:e}){return e&&r.stopPropagation(),!0},prevent({event:r,value:e}){return e&&r.preventDefault(),!0},self({event:r,value:e,element:t}){return e?t===r.target:!0}},ar=/^(?:(?:([^.]+?)\+)?(.+?)(?:\.(.+?))?(?:@(window|document))?->)?(.+?)(?:#([^:]+?))(?::(.+))?$/;function cr(r){const t=r.trim().match(ar)||[];let s=t[2],n=t[3];return n&&!["keydown","keyup","keypress"].includes(s)&&(s+=`.${n}`,n=""),{eventTarget:lr(t[4]),eventName:s,eventOptions:t[7]?ur(t[7]):{},identifier:t[5],methodName:t[6],keyFilter:t[1]||n}}function lr(r){if(r=="window")return window;if(r=="document")return document}function ur(r){return r.split(":").reduce((e,t)=>Object.assign(e,{[t.replace(/^!/,"")]:!/^!/.test(t)}),{})}function hr(r){if(r==window)return"window";if(r==document)return"document"}function Ae(r){return r.replace(/(?:[_-])([a-z0-9])/g,(e,t)=>t.toUpperCase())}function ye(r){return Ae(r.replace(/--/g,"-").replace(/__/g,"_"))}function q(r){return r.charAt(0).toUpperCase()+r.slice(1)}function vt(r){return r.replace(/([A-Z])/g,(e,t)=>`-${t.toLowerCase()}`)}function dr(r){return r.match(/[^\s]+/g)||[]}function Pe(r){return r!=null}function be(r,e){return Object.prototype.hasOwnProperty.call(r,e)}const $e=["meta","ctrl","alt","shift"];class fr{constructor(e,t,s,n){this.element=e,this.index=t,this.eventTarget=s.eventTarget||e,this.eventName=s.eventName||pr(e)||X("missing event name"),this.eventOptions=s.eventOptions||{},this.identifier=s.identifier||X("missing identifier"),this.methodName=s.methodName||X("missing method name"),this.keyFilter=s.keyFilter||"",this.schema=n}static forToken(e,t){return new this(e.element,e.index,cr(e.content),t)}toString(){const e=this.keyFilter?`.${this.keyFilter}`:"",t=this.eventTargetName?`@${this.eventTargetName}`:"";return`${this.eventName}${e}${t}->${this.identifier}#${this.methodName}`}shouldIgnoreKeyboardEvent(e){if(!this.keyFilter)return!1;const t=this.keyFilter.split("+");if(this.keyFilterDissatisfied(e,t))return!0;const s=t.filter(n=>!$e.includes(n))[0];return s?(be(this.keyMappings,s)||X(`contains unknown key filter: ${this.keyFilter}`),this.keyMappings[s].toLowerCase()!==e.key.toLowerCase()):!1}shouldIgnoreMouseEvent(e){if(!this.keyFilter)return!1;const t=[this.keyFilter];return!!this.keyFilterDissatisfied(e,t)}get params(){const e={},t=new RegExp(`^data-${this.identifier}-(.+)-param$`,"i");for(const{name:s,value:n}of Array.from(this.element.attributes)){const i=s.match(t),o=i&&i[1];o&&(e[Ae(o)]=mr(n))}return e}get eventTargetName(){return hr(this.eventTarget)}get keyMappings(){return this.schema.keyMappings}keyFilterDissatisfied(e,t){const[s,n,i,o]=$e.map(c=>t.includes(c));return e.metaKey!==s||e.ctrlKey!==n||e.altKey!==i||e.shiftKey!==o}}const Ve={a:()=>"click",button:()=>"click",form:()=>"submit",details:()=>"toggle",input:r=>r.getAttribute("type")=="submit"?"click":"input",select:()=>"change",textarea:()=>"input"};function pr(r){const e=r.tagName.toLowerCase();if(e in Ve)return Ve[e](r)}function X(r){throw new Error(r)}function mr(r){try{return JSON.parse(r)}catch{return r}}class gr{constructor(e,t){this.context=e,this.action=t}get index(){return this.action.index}get eventTarget(){return this.action.eventTarget}get eventOptions(){return this.action.eventOptions}get identifier(){return this.context.identifier}handleEvent(e){const t=this.prepareActionEvent(e);this.willBeInvokedByEvent(e)&&this.applyEventModifiers(t)&&this.invokeWithEvent(t)}get eventName(){return this.action.eventName}get method(){const e=this.controller[this.methodName];if(typeof e=="function")return e;throw new Error(`Action "${this.action}" references undefined method "${this.methodName}"`)}applyEventModifiers(e){const{element:t}=this.action,{actionDescriptorFilters:s}=this.context.application,{controller:n}=this.context;let i=!0;for(const[o,c]of Object.entries(this.eventOptions))if(o in s){const h=s[o];i=i&&h({name:o,value:c,event:e,element:t,controller:n})}else continue;return i}prepareActionEvent(e){return Object.assign(e,{params:this.action.params})}invokeWithEvent(e){const{target:t,currentTarget:s}=e;try{this.method.call(this.controller,e),this.context.logDebugActivity(this.methodName,{event:e,target:t,currentTarget:s,action:this.methodName})}catch(n){const{identifier:i,controller:o,element:c,index:h}=this,l={identifier:i,controller:o,element:c,index:h,event:e};this.context.handleError(n,`invoking action "${this.action}"`,l)}}willBeInvokedByEvent(e){const t=e.target;return e instanceof KeyboardEvent&&this.action.shouldIgnoreKeyboardEvent(e)||e instanceof MouseEvent&&this.action.shouldIgnoreMouseEvent(e)?!1:this.element===t?!0:t instanceof Element&&this.element.contains(t)?this.scope.containsElement(t):this.scope.containsElement(this.action.element)}get controller(){return this.context.controller}get methodName(){return this.action.methodName}get element(){return this.scope.element}get scope(){return this.context.scope}}class wt{constructor(e,t){this.mutationObserverInit={attributes:!0,childList:!0,subtree:!0},this.element=e,this.started=!1,this.delegate=t,this.elements=new Set,this.mutationObserver=new MutationObserver(s=>this.processMutations(s))}start(){this.started||(this.started=!0,this.mutationObserver.observe(this.element,this.mutationObserverInit),this.refresh())}pause(e){this.started&&(this.mutationObserver.disconnect(),this.started=!1),e(),this.started||(this.mutationObserver.observe(this.element,this.mutationObserverInit),this.started=!0)}stop(){this.started&&(this.mutationObserver.takeRecords(),this.mutationObserver.disconnect(),this.started=!1)}refresh(){if(this.started){const e=new Set(this.matchElementsInTree());for(const t of Array.from(this.elements))e.has(t)||this.removeElement(t);for(const t of Array.from(e))this.addElement(t)}}processMutations(e){if(this.started)for(const t of e)this.processMutation(t)}processMutation(e){e.type=="attributes"?this.processAttributeChange(e.target,e.attributeName):e.type=="childList"&&(this.processRemovedNodes(e.removedNodes),this.processAddedNodes(e.addedNodes))}processAttributeChange(e,t){this.elements.has(e)?this.delegate.elementAttributeChanged&&this.matchElement(e)?this.delegate.elementAttributeChanged(e,t):this.removeElement(e):this.matchElement(e)&&this.addElement(e)}processRemovedNodes(e){for(const t of Array.from(e)){const s=this.elementFromNode(t);s&&this.processTree(s,this.removeElement)}}processAddedNodes(e){for(const t of Array.from(e)){const s=this.elementFromNode(t);s&&this.elementIsActive(s)&&this.processTree(s,this.addElement)}}matchElement(e){return this.delegate.matchElement(e)}matchElementsInTree(e=this.element){return this.delegate.matchElementsInTree(e)}processTree(e,t){for(const s of this.matchElementsInTree(e))t.call(this,s)}elementFromNode(e){if(e.nodeType==Node.ELEMENT_NODE)return e}elementIsActive(e){return e.isConnected!=this.element.isConnected?!1:this.element.contains(e)}addElement(e){this.elements.has(e)||this.elementIsActive(e)&&(this.elements.add(e),this.delegate.elementMatched&&this.delegate.elementMatched(e))}removeElement(e){this.elements.has(e)&&(this.elements.delete(e),this.delegate.elementUnmatched&&this.delegate.elementUnmatched(e))}}class Et{constructor(e,t,s){this.attributeName=t,this.delegate=s,this.elementObserver=new wt(e,this)}get element(){return this.elementObserver.element}get selector(){return`[${this.attributeName}]`}start(){this.elementObserver.start()}pause(e){this.elementObserver.pause(e)}stop(){this.elementObserver.stop()}refresh(){this.elementObserver.refresh()}get started(){return this.elementObserver.started}matchElement(e){return e.hasAttribute(this.attributeName)}matchElementsInTree(e){const t=this.matchElement(e)?[e]:[],s=Array.from(e.querySelectorAll(this.selector));return t.concat(s)}elementMatched(e){this.delegate.elementMatchedAttribute&&this.delegate.elementMatchedAttribute(e,this.attributeName)}elementUnmatched(e){this.delegate.elementUnmatchedAttribute&&this.delegate.elementUnmatchedAttribute(e,this.attributeName)}elementAttributeChanged(e,t){this.delegate.elementAttributeValueChanged&&this.attributeName==t&&this.delegate.elementAttributeValueChanged(e,t)}}function yr(r,e,t){Ot(r,e).add(t)}function br(r,e,t){Ot(r,e).delete(t),vr(r,e)}function Ot(r,e){let t=r.get(e);return t||(t=new Set,r.set(e,t)),t}function vr(r,e){const t=r.get(e);t!=null&&t.size==0&&r.delete(e)}class L{constructor(){this.valuesByKey=new Map}get keys(){return Array.from(this.valuesByKey.keys())}get values(){return Array.from(this.valuesByKey.values()).reduce((t,s)=>t.concat(Array.from(s)),[])}get size(){return Array.from(this.valuesByKey.values()).reduce((t,s)=>t+s.size,0)}add(e,t){yr(this.valuesByKey,e,t)}delete(e,t){br(this.valuesByKey,e,t)}has(e,t){const s=this.valuesByKey.get(e);return s!=null&&s.has(t)}hasKey(e){return this.valuesByKey.has(e)}hasValue(e){return Array.from(this.valuesByKey.values()).some(s=>s.has(e))}getValuesForKey(e){const t=this.valuesByKey.get(e);return t?Array.from(t):[]}getKeysForValue(e){return Array.from(this.valuesByKey).filter(([t,s])=>s.has(e)).map(([t,s])=>t)}}class wr{constructor(e,t,s,n){this._selector=t,this.details=n,this.elementObserver=new wt(e,this),this.delegate=s,this.matchesByElement=new L}get started(){return this.elementObserver.started}get selector(){return this._selector}set selector(e){this._selector=e,this.refresh()}start(){this.elementObserver.start()}pause(e){this.elementObserver.pause(e)}stop(){this.elementObserver.stop()}refresh(){this.elementObserver.refresh()}get element(){return this.elementObserver.element}matchElement(e){const{selector:t}=this;if(t){const s=e.matches(t);return this.delegate.selectorMatchElement?s&&this.delegate.selectorMatchElement(e,this.details):s}else return!1}matchElementsInTree(e){const{selector:t}=this;if(t){const s=this.matchElement(e)?[e]:[],n=Array.from(e.querySelectorAll(t)).filter(i=>this.matchElement(i));return s.concat(n)}else return[]}elementMatched(e){const{selector:t}=this;t&&this.selectorMatched(e,t)}elementUnmatched(e){const t=this.matchesByElement.getKeysForValue(e);for(const s of t)this.selectorUnmatched(e,s)}elementAttributeChanged(e,t){const{selector:s}=this;if(s){const n=this.matchElement(e),i=this.matchesByElement.has(s,e);n&&!i?this.selectorMatched(e,s):!n&&i&&this.selectorUnmatched(e,s)}}selectorMatched(e,t){this.delegate.selectorMatched(e,t,this.details),this.matchesByElement.add(t,e)}selectorUnmatched(e,t){this.delegate.selectorUnmatched(e,t,this.details),this.matchesByElement.delete(t,e)}}class Er{constructor(e,t){this.element=e,this.delegate=t,this.started=!1,this.stringMap=new Map,this.mutationObserver=new MutationObserver(s=>this.processMutations(s))}start(){this.started||(this.started=!0,this.mutationObserver.observe(this.element,{attributes:!0,attributeOldValue:!0}),this.refresh())}stop(){this.started&&(this.mutationObserver.takeRecords(),this.mutationObserver.disconnect(),this.started=!1)}refresh(){if(this.started)for(const e of this.knownAttributeNames)this.refreshAttribute(e,null)}processMutations(e){if(this.started)for(const t of e)this.processMutation(t)}processMutation(e){const t=e.attributeName;t&&this.refreshAttribute(t,e.oldValue)}refreshAttribute(e,t){const s=this.delegate.getStringMapKeyForAttribute(e);if(s!=null){this.stringMap.has(e)||this.stringMapKeyAdded(s,e);const n=this.element.getAttribute(e);if(this.stringMap.get(e)!=n&&this.stringMapValueChanged(n,s,t),n==null){const i=this.stringMap.get(e);this.stringMap.delete(e),i&&this.stringMapKeyRemoved(s,e,i)}else this.stringMap.set(e,n)}}stringMapKeyAdded(e,t){this.delegate.stringMapKeyAdded&&this.delegate.stringMapKeyAdded(e,t)}stringMapValueChanged(e,t,s){this.delegate.stringMapValueChanged&&this.delegate.stringMapValueChanged(e,t,s)}stringMapKeyRemoved(e,t,s){this.delegate.stringMapKeyRemoved&&this.delegate.stringMapKeyRemoved(e,t,s)}get knownAttributeNames(){return Array.from(new Set(this.currentAttributeNames.concat(this.recordedAttributeNames)))}get currentAttributeNames(){return Array.from(this.element.attributes).map(e=>e.name)}get recordedAttributeNames(){return Array.from(this.stringMap.keys())}}class At{constructor(e,t,s){this.attributeObserver=new Et(e,t,this),this.delegate=s,this.tokensByElement=new L}get started(){return this.attributeObserver.started}start(){this.attributeObserver.start()}pause(e){this.attributeObserver.pause(e)}stop(){this.attributeObserver.stop()}refresh(){this.attributeObserver.refresh()}get element(){return this.attributeObserver.element}get attributeName(){return this.attributeObserver.attributeName}elementMatchedAttribute(e){this.tokensMatched(this.readTokensForElement(e))}elementAttributeValueChanged(e){const[t,s]=this.refreshTokensForElement(e);this.tokensUnmatched(t),this.tokensMatched(s)}elementUnmatchedAttribute(e){this.tokensUnmatched(this.tokensByElement.getValuesForKey(e))}tokensMatched(e){e.forEach(t=>this.tokenMatched(t))}tokensUnmatched(e){e.forEach(t=>this.tokenUnmatched(t))}tokenMatched(e){this.delegate.tokenMatched(e),this.tokensByElement.add(e.element,e)}tokenUnmatched(e){this.delegate.tokenUnmatched(e),this.tokensByElement.delete(e.element,e)}refreshTokensForElement(e){const t=this.tokensByElement.getValuesForKey(e),s=this.readTokensForElement(e),n=Ar(t,s).findIndex(([i,o])=>!Tr(i,o));return n==-1?[[],[]]:[t.slice(n),s.slice(n)]}readTokensForElement(e){const t=this.attributeName,s=e.getAttribute(t)||"";return Or(s,e,t)}}function Or(r,e,t){return r.trim().split(/\s+/).filter(s=>s.length).map((s,n)=>({element:e,attributeName:t,content:s,index:n}))}function Ar(r,e){const t=Math.max(r.length,e.length);return Array.from({length:t},(s,n)=>[r[n],e[n]])}function Tr(r,e){return r&&e&&r.index==e.index&&r.content==e.content}class Tt{constructor(e,t,s){this.tokenListObserver=new At(e,t,this),this.delegate=s,this.parseResultsByToken=new WeakMap,this.valuesByTokenByElement=new WeakMap}get started(){return this.tokenListObserver.started}start(){this.tokenListObserver.start()}stop(){this.tokenListObserver.stop()}refresh(){this.tokenListObserver.refresh()}get element(){return this.tokenListObserver.element}get attributeName(){return this.tokenListObserver.attributeName}tokenMatched(e){const{element:t}=e,{value:s}=this.fetchParseResultForToken(e);s&&(this.fetchValuesByTokenForElement(t).set(e,s),this.delegate.elementMatchedValue(t,s))}tokenUnmatched(e){const{element:t}=e,{value:s}=this.fetchParseResultForToken(e);s&&(this.fetchValuesByTokenForElement(t).delete(e),this.delegate.elementUnmatchedValue(t,s))}fetchParseResultForToken(e){let t=this.parseResultsByToken.get(e);return t||(t=this.parseToken(e),this.parseResultsByToken.set(e,t)),t}fetchValuesByTokenForElement(e){let t=this.valuesByTokenByElement.get(e);return t||(t=new Map,this.valuesByTokenByElement.set(e,t)),t}parseToken(e){try{return{value:this.delegate.parseValueForToken(e)}}catch(t){return{error:t}}}}class Cr{constructor(e,t){this.context=e,this.delegate=t,this.bindingsByAction=new Map}start(){this.valueListObserver||(this.valueListObserver=new Tt(this.element,this.actionAttribute,this),this.valueListObserver.start())}stop(){this.valueListObserver&&(this.valueListObserver.stop(),delete this.valueListObserver,this.disconnectAllActions())}get element(){return this.context.element}get identifier(){return this.context.identifier}get actionAttribute(){return this.schema.actionAttribute}get schema(){return this.context.schema}get bindings(){return Array.from(this.bindingsByAction.values())}connectAction(e){const t=new gr(this.context,e);this.bindingsByAction.set(e,t),this.delegate.bindingConnected(t)}disconnectAction(e){const t=this.bindingsByAction.get(e);t&&(this.bindingsByAction.delete(e),this.delegate.bindingDisconnected(t))}disconnectAllActions(){this.bindings.forEach(e=>this.delegate.bindingDisconnected(e,!0)),this.bindingsByAction.clear()}parseValueForToken(e){const t=fr.forToken(e,this.schema);if(t.identifier==this.identifier)return t}elementMatchedValue(e,t){this.connectAction(t)}elementUnmatchedValue(e,t){this.disconnectAction(t)}}class Sr{constructor(e,t){this.context=e,this.receiver=t,this.stringMapObserver=new Er(this.element,this),this.valueDescriptorMap=this.controller.valueDescriptorMap}start(){this.stringMapObserver.start(),this.invokeChangedCallbacksForDefaultValues()}stop(){this.stringMapObserver.stop()}get element(){return this.context.element}get controller(){return this.context.controller}getStringMapKeyForAttribute(e){if(e in this.valueDescriptorMap)return this.valueDescriptorMap[e].name}stringMapKeyAdded(e,t){const s=this.valueDescriptorMap[t];this.hasValue(e)||this.invokeChangedCallback(e,s.writer(this.receiver[e]),s.writer(s.defaultValue))}stringMapValueChanged(e,t,s){const n=this.valueDescriptorNameMap[t];e!==null&&(s===null&&(s=n.writer(n.defaultValue)),this.invokeChangedCallback(t,e,s))}stringMapKeyRemoved(e,t,s){const n=this.valueDescriptorNameMap[e];this.hasValue(e)?this.invokeChangedCallback(e,n.writer(this.receiver[e]),s):this.invokeChangedCallback(e,n.writer(n.defaultValue),s)}invokeChangedCallbacksForDefaultValues(){for(const{key:e,name:t,defaultValue:s,writer:n}of this.valueDescriptors)s!=null&&!this.controller.data.has(e)&&this.invokeChangedCallback(t,n(s),void 0)}invokeChangedCallback(e,t,s){const n=`${e}Changed`,i=this.receiver[n];if(typeof i=="function"){const o=this.valueDescriptorNameMap[e];try{const c=o.reader(t);let h=s;s&&(h=o.reader(s)),i.call(this.receiver,c,h)}catch(c){throw c instanceof TypeError&&(c.message=`Stimulus Value "${this.context.identifier}.${o.name}" - ${c.message}`),c}}}get valueDescriptors(){const{valueDescriptorMap:e}=this;return Object.keys(e).map(t=>e[t])}get valueDescriptorNameMap(){const e={};return Object.keys(this.valueDescriptorMap).forEach(t=>{const s=this.valueDescriptorMap[t];e[s.name]=s}),e}hasValue(e){const t=this.valueDescriptorNameMap[e],s=`has${q(t.name)}`;return this.receiver[s]}}class xr{constructor(e,t){this.context=e,this.delegate=t,this.targetsByName=new L}start(){this.tokenListObserver||(this.tokenListObserver=new At(this.element,this.attributeName,this),this.tokenListObserver.start())}stop(){this.tokenListObserver&&(this.disconnectAllTargets(),this.tokenListObserver.stop(),delete this.tokenListObserver)}tokenMatched({element:e,content:t}){this.scope.containsElement(e)&&this.connectTarget(e,t)}tokenUnmatched({element:e,content:t}){this.disconnectTarget(e,t)}connectTarget(e,t){var s;this.targetsByName.has(t,e)||(this.targetsByName.add(t,e),(s=this.tokenListObserver)===null||s===void 0||s.pause(()=>this.delegate.targetConnected(e,t)))}disconnectTarget(e,t){var s;this.targetsByName.has(t,e)&&(this.targetsByName.delete(t,e),(s=this.tokenListObserver)===null||s===void 0||s.pause(()=>this.delegate.targetDisconnected(e,t)))}disconnectAllTargets(){for(const e of this.targetsByName.keys)for(const t of this.targetsByName.getValuesForKey(e))this.disconnectTarget(t,e)}get attributeName(){return`data-${this.context.identifier}-target`}get element(){return this.context.element}get scope(){return this.context.scope}}function z(r,e){const t=Ct(r);return Array.from(t.reduce((s,n)=>(kr(n,e).forEach(i=>s.add(i)),s),new Set))}function Fr(r,e){return Ct(r).reduce((s,n)=>(s.push(...Mr(n,e)),s),[])}function Ct(r){const e=[];for(;r;)e.push(r),r=Object.getPrototypeOf(r);return e.reverse()}function kr(r,e){const t=r[e];return Array.isArray(t)?t:[]}function Mr(r,e){const t=r[e];return t?Object.keys(t).map(s=>[s,t[s]]):[]}class Nr{constructor(e,t){this.started=!1,this.context=e,this.delegate=t,this.outletsByName=new L,this.outletElementsByName=new L,this.selectorObserverMap=new Map,this.attributeObserverMap=new Map}start(){this.started||(this.outletDefinitions.forEach(e=>{this.setupSelectorObserverForOutlet(e),this.setupAttributeObserverForOutlet(e)}),this.started=!0,this.dependentContexts.forEach(e=>e.refresh()))}refresh(){this.selectorObserverMap.forEach(e=>e.refresh()),this.attributeObserverMap.forEach(e=>e.refresh())}stop(){this.started&&(this.started=!1,this.disconnectAllOutlets(),this.stopSelectorObservers(),this.stopAttributeObservers())}stopSelectorObservers(){this.selectorObserverMap.size>0&&(this.selectorObserverMap.forEach(e=>e.stop()),this.selectorObserverMap.clear())}stopAttributeObservers(){this.attributeObserverMap.size>0&&(this.attributeObserverMap.forEach(e=>e.stop()),this.attributeObserverMap.clear())}selectorMatched(e,t,{outletName:s}){const n=this.getOutlet(e,s);n&&this.connectOutlet(n,e,s)}selectorUnmatched(e,t,{outletName:s}){const n=this.getOutletFromMap(e,s);n&&this.disconnectOutlet(n,e,s)}selectorMatchElement(e,{outletName:t}){const s=this.selector(t),n=this.hasOutlet(e,t),i=e.matches(`[${this.schema.controllerAttribute}~=${t}]`);return s?n&&i&&e.matches(s):!1}elementMatchedAttribute(e,t){const s=this.getOutletNameFromOutletAttributeName(t);s&&this.updateSelectorObserverForOutlet(s)}elementAttributeValueChanged(e,t){const s=this.getOutletNameFromOutletAttributeName(t);s&&this.updateSelectorObserverForOutlet(s)}elementUnmatchedAttribute(e,t){const s=this.getOutletNameFromOutletAttributeName(t);s&&this.updateSelectorObserverForOutlet(s)}connectOutlet(e,t,s){var n;this.outletElementsByName.has(s,t)||(this.outletsByName.add(s,e),this.outletElementsByName.add(s,t),(n=this.selectorObserverMap.get(s))===null||n===void 0||n.pause(()=>this.delegate.outletConnected(e,t,s)))}disconnectOutlet(e,t,s){var n;this.outletElementsByName.has(s,t)&&(this.outletsByName.delete(s,e),this.outletElementsByName.delete(s,t),(n=this.selectorObserverMap.get(s))===null||n===void 0||n.pause(()=>this.delegate.outletDisconnected(e,t,s)))}disconnectAllOutlets(){for(const e of this.outletElementsByName.keys)for(const t of this.outletElementsByName.getValuesForKey(e))for(const s of this.outletsByName.getValuesForKey(e))this.disconnectOutlet(s,t,e)}updateSelectorObserverForOutlet(e){const t=this.selectorObserverMap.get(e);t&&(t.selector=this.selector(e))}setupSelectorObserverForOutlet(e){const t=this.selector(e),s=new wr(document.body,t,this,{outletName:e});this.selectorObserverMap.set(e,s),s.start()}setupAttributeObserverForOutlet(e){const t=this.attributeNameForOutletName(e),s=new Et(this.scope.element,t,this);this.attributeObserverMap.set(e,s),s.start()}selector(e){return this.scope.outlets.getSelectorForOutletName(e)}attributeNameForOutletName(e){return this.scope.schema.outletAttributeForScope(this.identifier,e)}getOutletNameFromOutletAttributeName(e){return this.outletDefinitions.find(t=>this.attributeNameForOutletName(t)===e)}get outletDependencies(){const e=new L;return this.router.modules.forEach(t=>{const s=t.definition.controllerConstructor;z(s,"outlets").forEach(i=>e.add(i,t.identifier))}),e}get outletDefinitions(){return this.outletDependencies.getKeysForValue(this.identifier)}get dependentControllerIdentifiers(){return this.outletDependencies.getValuesForKey(this.identifier)}get dependentContexts(){const e=this.dependentControllerIdentifiers;return this.router.contexts.filter(t=>e.includes(t.identifier))}hasOutlet(e,t){return!!this.getOutlet(e,t)||!!this.getOutletFromMap(e,t)}getOutlet(e,t){return this.application.getControllerForElementAndIdentifier(e,t)}getOutletFromMap(e,t){return this.outletsByName.getValuesForKey(t).find(s=>s.element===e)}get scope(){return this.context.scope}get schema(){return this.context.schema}get identifier(){return this.context.identifier}get application(){return this.context.application}get router(){return this.application.router}}class Rr{constructor(e,t){this.logDebugActivity=(s,n={})=>{const{identifier:i,controller:o,element:c}=this;n=Object.assign({identifier:i,controller:o,element:c},n),this.application.logDebugActivity(this.identifier,s,n)},this.module=e,this.scope=t,this.controller=new e.controllerConstructor(this),this.bindingObserver=new Cr(this,this.dispatcher),this.valueObserver=new Sr(this,this.controller),this.targetObserver=new xr(this,this),this.outletObserver=new Nr(this,this);try{this.controller.initialize(),this.logDebugActivity("initialize")}catch(s){this.handleError(s,"initializing controller")}}connect(){this.bindingObserver.start(),this.valueObserver.start(),this.targetObserver.start(),this.outletObserver.start();try{this.controller.connect(),this.logDebugActivity("connect")}catch(e){this.handleError(e,"connecting controller")}}refresh(){this.outletObserver.refresh()}disconnect(){try{this.controller.disconnect(),this.logDebugActivity("disconnect")}catch(e){this.handleError(e,"disconnecting controller")}this.outletObserver.stop(),this.targetObserver.stop(),this.valueObserver.stop(),this.bindingObserver.stop()}get application(){return this.module.application}get identifier(){return this.module.identifier}get schema(){return this.application.schema}get dispatcher(){return this.application.dispatcher}get element(){return this.scope.element}get parentElement(){return this.element.parentElement}handleError(e,t,s={}){const{identifier:n,controller:i,element:o}=this;s=Object.assign({identifier:n,controller:i,element:o},s),this.application.handleError(e,`Error ${t}`,s)}targetConnected(e,t){this.invokeControllerMethod(`${t}TargetConnected`,e)}targetDisconnected(e,t){this.invokeControllerMethod(`${t}TargetDisconnected`,e)}outletConnected(e,t,s){this.invokeControllerMethod(`${ye(s)}OutletConnected`,e,t)}outletDisconnected(e,t,s){this.invokeControllerMethod(`${ye(s)}OutletDisconnected`,e,t)}invokeControllerMethod(e,...t){const s=this.controller;typeof s[e]=="function"&&s[e](...t)}}function Br(r){return Lr(r,Dr(r))}function Lr(r,e){const t=Pr(r),s=Ir(r.prototype,e);return Object.defineProperties(t.prototype,s),t}function Dr(r){return z(r,"blessings").reduce((t,s)=>{const n=s(r);for(const i in n){const o=t[i]||{};t[i]=Object.assign(o,n[i])}return t},{})}function Ir(r,e){return Kr(e).reduce((t,s)=>{const n=jr(r,e,s);return n&&Object.assign(t,{[s]:n}),t},{})}function jr(r,e,t){const s=Object.getOwnPropertyDescriptor(r,t);if(!(s&&"value"in s)){const i=Object.getOwnPropertyDescriptor(e,t).value;return s&&(i.get=s.get||i.get,i.set=s.set||i.set),i}}const Kr=typeof Object.getOwnPropertySymbols=="function"?r=>[...Object.getOwnPropertyNames(r),...Object.getOwnPropertySymbols(r)]:Object.getOwnPropertyNames,Pr=(()=>{function r(t){function s(){return Reflect.construct(t,arguments,new.target)}return s.prototype=Object.create(t.prototype,{constructor:{value:s}}),Reflect.setPrototypeOf(s,t),s}function e(){const s=r(function(){this.a.call(this)});return s.prototype.a=function(){},new s}try{return e(),r}catch{return s=>class extends s{}}})();function $r(r){return{identifier:r.identifier,controllerConstructor:Br(r.controllerConstructor)}}class Vr{constructor(e,t){this.application=e,this.definition=$r(t),this.contextsByScope=new WeakMap,this.connectedContexts=new Set}get identifier(){return this.definition.identifier}get controllerConstructor(){return this.definition.controllerConstructor}get contexts(){return Array.from(this.connectedContexts)}connectContextForScope(e){const t=this.fetchContextForScope(e);this.connectedContexts.add(t),t.connect()}disconnectContextForScope(e){const t=this.contextsByScope.get(e);t&&(this.connectedContexts.delete(t),t.disconnect())}fetchContextForScope(e){let t=this.contextsByScope.get(e);return t||(t=new Rr(this,e),this.contextsByScope.set(e,t)),t}}class _r{constructor(e){this.scope=e}has(e){return this.data.has(this.getDataKey(e))}get(e){return this.getAll(e)[0]}getAll(e){const t=this.data.get(this.getDataKey(e))||"";return dr(t)}getAttributeName(e){return this.data.getAttributeNameForKey(this.getDataKey(e))}getDataKey(e){return`${e}-class`}get data(){return this.scope.data}}class Ur{constructor(e){this.scope=e}get element(){return this.scope.element}get identifier(){return this.scope.identifier}get(e){const t=this.getAttributeNameForKey(e);return this.element.getAttribute(t)}set(e,t){const s=this.getAttributeNameForKey(e);return this.element.setAttribute(s,t),this.get(e)}has(e){const t=this.getAttributeNameForKey(e);return this.element.hasAttribute(t)}delete(e){if(this.has(e)){const t=this.getAttributeNameForKey(e);return this.element.removeAttribute(t),!0}else return!1}getAttributeNameForKey(e){return`data-${this.identifier}-${vt(e)}`}}class Hr{constructor(e){this.warnedKeysByObject=new WeakMap,this.logger=e}warn(e,t,s){let n=this.warnedKeysByObject.get(e);n||(n=new Set,this.warnedKeysByObject.set(e,n)),n.has(t)||(n.add(t),this.logger.warn(s,e))}}function ve(r,e){return`[${r}~="${e}"]`}class qr{constructor(e){this.scope=e}get element(){return this.scope.element}get identifier(){return this.scope.identifier}get schema(){return this.scope.schema}has(e){return this.find(e)!=null}find(...e){return e.reduce((t,s)=>t||this.findTarget(s)||this.findLegacyTarget(s),void 0)}findAll(...e){return e.reduce((t,s)=>[...t,...this.findAllTargets(s),...this.findAllLegacyTargets(s)],[])}findTarget(e){const t=this.getSelectorForTargetName(e);return this.scope.findElement(t)}findAllTargets(e){const t=this.getSelectorForTargetName(e);return this.scope.findAllElements(t)}getSelectorForTargetName(e){const t=this.schema.targetAttributeForScope(this.identifier);return ve(t,e)}findLegacyTarget(e){const t=this.getLegacySelectorForTargetName(e);return this.deprecate(this.scope.findElement(t),e)}findAllLegacyTargets(e){const t=this.getLegacySelectorForTargetName(e);return this.scope.findAllElements(t).map(s=>this.deprecate(s,e))}getLegacySelectorForTargetName(e){const t=`${this.identifier}.${e}`;return ve(this.schema.targetAttribute,t)}deprecate(e,t){if(e){const{identifier:s}=this,n=this.schema.targetAttribute,i=this.schema.targetAttributeForScope(s);this.guide.warn(e,`target:${t}`,`Please replace ${n}="${s}.${t}" with ${i}="${t}". The ${n} attribute is deprecated and will be removed in a future version of Stimulus.`)}return e}get guide(){return this.scope.guide}}class zr{constructor(e,t){this.scope=e,this.controllerElement=t}get element(){return this.scope.element}get identifier(){return this.scope.identifier}get schema(){return this.scope.schema}has(e){return this.find(e)!=null}find(...e){return e.reduce((t,s)=>t||this.findOutlet(s),void 0)}findAll(...e){return e.reduce((t,s)=>[...t,...this.findAllOutlets(s)],[])}getSelectorForOutletName(e){const t=this.schema.outletAttributeForScope(this.identifier,e);return this.controllerElement.getAttribute(t)}findOutlet(e){const t=this.getSelectorForOutletName(e);if(t)return this.findElement(t,e)}findAllOutlets(e){const t=this.getSelectorForOutletName(e);return t?this.findAllElements(t,e):[]}findElement(e,t){return this.scope.queryElements(e).filter(n=>this.matchesElement(n,e,t))[0]}findAllElements(e,t){return this.scope.queryElements(e).filter(n=>this.matchesElement(n,e,t))}matchesElement(e,t,s){const n=e.getAttribute(this.scope.schema.controllerAttribute)||"";return e.matches(t)&&n.split(" ").includes(s)}}class Te{constructor(e,t,s,n){this.targets=new qr(this),this.classes=new _r(this),this.data=new Ur(this),this.containsElement=i=>i.closest(this.controllerSelector)===this.element,this.schema=e,this.element=t,this.identifier=s,this.guide=new Hr(n),this.outlets=new zr(this.documentScope,t)}findElement(e){return this.element.matches(e)?this.element:this.queryElements(e).find(this.containsElement)}findAllElements(e){return[...this.element.matches(e)?[this.element]:[],...this.queryElements(e).filter(this.containsElement)]}queryElements(e){return Array.from(this.element.querySelectorAll(e))}get controllerSelector(){return ve(this.schema.controllerAttribute,this.identifier)}get isDocumentScope(){return this.element===document.documentElement}get documentScope(){return this.isDocumentScope?this:new Te(this.schema,document.documentElement,this.identifier,this.guide.logger)}}class Jr{constructor(e,t,s){this.element=e,this.schema=t,this.delegate=s,this.valueListObserver=new Tt(this.element,this.controllerAttribute,this),this.scopesByIdentifierByElement=new WeakMap,this.scopeReferenceCounts=new WeakMap}start(){this.valueListObserver.start()}stop(){this.valueListObserver.stop()}get controllerAttribute(){return this.schema.controllerAttribute}parseValueForToken(e){const{element:t,content:s}=e;return this.parseValueForElementAndIdentifier(t,s)}parseValueForElementAndIdentifier(e,t){const s=this.fetchScopesByIdentifierForElement(e);let n=s.get(t);return n||(n=this.delegate.createScopeForElementAndIdentifier(e,t),s.set(t,n)),n}elementMatchedValue(e,t){const s=(this.scopeReferenceCounts.get(t)||0)+1;this.scopeReferenceCounts.set(t,s),s==1&&this.delegate.scopeConnected(t)}elementUnmatchedValue(e,t){const s=this.scopeReferenceCounts.get(t);s&&(this.scopeReferenceCounts.set(t,s-1),s==1&&this.delegate.scopeDisconnected(t))}fetchScopesByIdentifierForElement(e){let t=this.scopesByIdentifierByElement.get(e);return t||(t=new Map,this.scopesByIdentifierByElement.set(e,t)),t}}class Wr{constructor(e){this.application=e,this.scopeObserver=new Jr(this.element,this.schema,this),this.scopesByIdentifier=new L,this.modulesByIdentifier=new Map}get element(){return this.application.element}get schema(){return this.application.schema}get logger(){return this.application.logger}get controllerAttribute(){return this.schema.controllerAttribute}get modules(){return Array.from(this.modulesByIdentifier.values())}get contexts(){return this.modules.reduce((e,t)=>e.concat(t.contexts),[])}start(){this.scopeObserver.start()}stop(){this.scopeObserver.stop()}loadDefinition(e){this.unloadIdentifier(e.identifier);const t=new Vr(this.application,e);this.connectModule(t);const s=e.controllerConstructor.afterLoad;s&&s.call(e.controllerConstructor,e.identifier,this.application)}unloadIdentifier(e){const t=this.modulesByIdentifier.get(e);t&&this.disconnectModule(t)}getContextForElementAndIdentifier(e,t){const s=this.modulesByIdentifier.get(t);if(s)return s.contexts.find(n=>n.element==e)}proposeToConnectScopeForElementAndIdentifier(e,t){const s=this.scopeObserver.parseValueForElementAndIdentifier(e,t);s?this.scopeObserver.elementMatchedValue(s.element,s):console.error(`Couldn't find or create scope for identifier: "${t}" and element:`,e)}handleError(e,t,s){this.application.handleError(e,t,s)}createScopeForElementAndIdentifier(e,t){return new Te(this.schema,e,t,this.logger)}scopeConnected(e){this.scopesByIdentifier.add(e.identifier,e);const t=this.modulesByIdentifier.get(e.identifier);t&&t.connectContextForScope(e)}scopeDisconnected(e){this.scopesByIdentifier.delete(e.identifier,e);const t=this.modulesByIdentifier.get(e.identifier);t&&t.disconnectContextForScope(e)}connectModule(e){this.modulesByIdentifier.set(e.identifier,e),this.scopesByIdentifier.getValuesForKey(e.identifier).forEach(s=>e.connectContextForScope(s))}disconnectModule(e){this.modulesByIdentifier.delete(e.identifier),this.scopesByIdentifier.getValuesForKey(e.identifier).forEach(s=>e.disconnectContextForScope(s))}}const Xr={controllerAttribute:"data-controller",actionAttribute:"data-action",targetAttribute:"data-target",targetAttributeForScope:r=>`data-${r}-target`,outletAttributeForScope:(r,e)=>`data-${r}-${e}-outlet`,keyMappings:Object.assign(Object.assign({enter:"Enter",tab:"Tab",esc:"Escape",space:" ",up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",home:"Home",end:"End",page_up:"PageUp",page_down:"PageDown"},_e("abcdefghijklmnopqrstuvwxyz".split("").map(r=>[r,r]))),_e("0123456789".split("").map(r=>[r,r])))};function _e(r){return r.reduce((e,[t,s])=>Object.assign(Object.assign({},e),{[t]:s}),{})}class Gr{constructor(e=document.documentElement,t=Xr){this.logger=console,this.debug=!1,this.logDebugActivity=(s,n,i={})=>{this.debug&&this.logFormattedMessage(s,n,i)},this.element=e,this.schema=t,this.dispatcher=new ir(this),this.router=new Wr(this),this.actionDescriptorFilters=Object.assign({},or)}static start(e,t){const s=new this(e,t);return s.start(),s}async start(){await Zr(),this.logDebugActivity("application","starting"),this.dispatcher.start(),this.router.start(),this.logDebugActivity("application","start")}stop(){this.logDebugActivity("application","stopping"),this.dispatcher.stop(),this.router.stop(),this.logDebugActivity("application","stop")}register(e,t){this.load({identifier:e,controllerConstructor:t})}registerActionOption(e,t){this.actionDescriptorFilters[e]=t}load(e,...t){(Array.isArray(e)?e:[e,...t]).forEach(n=>{n.controllerConstructor.shouldLoad&&this.router.loadDefinition(n)})}unload(e,...t){(Array.isArray(e)?e:[e,...t]).forEach(n=>this.router.unloadIdentifier(n))}get controllers(){return this.router.contexts.map(e=>e.controller)}getControllerForElementAndIdentifier(e,t){const s=this.router.getContextForElementAndIdentifier(e,t);return s?s.controller:null}handleError(e,t,s){var n;this.logger.error(`%s

%o

%o`,t,e,s),(n=window.onerror)===null||n===void 0||n.call(window,t,"",0,0,e)}logFormattedMessage(e,t,s={}){s=Object.assign({application:this},s),this.logger.groupCollapsed(`${e} #${t}`),this.logger.log("details:",Object.assign({},s)),this.logger.groupEnd()}}function Zr(){return new Promise(r=>{document.readyState=="loading"?document.addEventListener("DOMContentLoaded",()=>r()):r()})}function Qr(r){return z(r,"classes").reduce((t,s)=>Object.assign(t,Yr(s)),{})}function Yr(r){return{[`${r}Class`]:{get(){const{classes:e}=this;if(e.has(r))return e.get(r);{const t=e.getAttributeName(r);throw new Error(`Missing attribute "${t}"`)}}},[`${r}Classes`]:{get(){return this.classes.getAll(r)}},[`has${q(r)}Class`]:{get(){return this.classes.has(r)}}}}function en(r){return z(r,"outlets").reduce((t,s)=>Object.assign(t,tn(s)),{})}function Ue(r,e,t){return r.application.getControllerForElementAndIdentifier(e,t)}function He(r,e,t){let s=Ue(r,e,t);if(s||(r.application.router.proposeToConnectScopeForElementAndIdentifier(e,t),s=Ue(r,e,t),s))return s}function tn(r){const e=ye(r);return{[`${e}Outlet`]:{get(){const t=this.outlets.find(r),s=this.outlets.getSelectorForOutletName(r);if(t){const n=He(this,t,r);if(n)return n;throw new Error(`The provided outlet element is missing an outlet controller "${r}" instance for host controller "${this.identifier}"`)}throw new Error(`Missing outlet element "${r}" for host controller "${this.identifier}". Stimulus couldn't find a matching outlet element using selector "${s}".`)}},[`${e}Outlets`]:{get(){const t=this.outlets.findAll(r);return t.length>0?t.map(s=>{const n=He(this,s,r);if(n)return n;console.warn(`The provided outlet element is missing an outlet controller "${r}" instance for host controller "${this.identifier}"`,s)}).filter(s=>s):[]}},[`${e}OutletElement`]:{get(){const t=this.outlets.find(r),s=this.outlets.getSelectorForOutletName(r);if(t)return t;throw new Error(`Missing outlet element "${r}" for host controller "${this.identifier}". Stimulus couldn't find a matching outlet element using selector "${s}".`)}},[`${e}OutletElements`]:{get(){return this.outlets.findAll(r)}},[`has${q(e)}Outlet`]:{get(){return this.outlets.has(r)}}}}function sn(r){return z(r,"targets").reduce((t,s)=>Object.assign(t,rn(s)),{})}function rn(r){return{[`${r}Target`]:{get(){const e=this.targets.find(r);if(e)return e;throw new Error(`Missing target element "${r}" for "${this.identifier}" controller`)}},[`${r}Targets`]:{get(){return this.targets.findAll(r)}},[`has${q(r)}Target`]:{get(){return this.targets.has(r)}}}}function nn(r){const e=Fr(r,"values"),t={valueDescriptorMap:{get(){return e.reduce((s,n)=>{const i=St(n,this.identifier),o=this.data.getAttributeNameForKey(i.key);return Object.assign(s,{[o]:i})},{})}}};return e.reduce((s,n)=>Object.assign(s,on(n)),t)}function on(r,e){const t=St(r,e),{key:s,name:n,reader:i,writer:o}=t;return{[n]:{get(){const c=this.data.get(s);return c!==null?i(c):t.defaultValue},set(c){c===void 0?this.data.delete(s):this.data.set(s,o(c))}},[`has${q(n)}`]:{get(){return this.data.has(s)||t.hasCustomDefaultValue}}}}function St([r,e],t){return un({controller:t,token:r,typeDefinition:e})}function te(r){switch(r){case Array:return"array";case Boolean:return"boolean";case Number:return"number";case Object:return"object";case String:return"string"}}function $(r){switch(typeof r){case"boolean":return"boolean";case"number":return"number";case"string":return"string"}if(Array.isArray(r))return"array";if(Object.prototype.toString.call(r)==="[object Object]")return"object"}function an(r){const{controller:e,token:t,typeObject:s}=r,n=Pe(s.type),i=Pe(s.default),o=n&&i,c=n&&!i,h=!n&&i,l=te(s.type),u=$(r.typeObject.default);if(c)return l;if(h)return u;if(l!==u){const d=e?`${e}.${t}`:t;throw new Error(`The specified default value for the Stimulus Value "${d}" must match the defined type "${l}". The provided default value of "${s.default}" is of type "${u}".`)}if(o)return l}function cn(r){const{controller:e,token:t,typeDefinition:s}=r,i=an({controller:e,token:t,typeObject:s}),o=$(s),c=te(s),h=i||o||c;if(h)return h;const l=e?`${e}.${s}`:t;throw new Error(`Unknown value type "${l}" for "${t}" value`)}function ln(r){const e=te(r);if(e)return qe[e];const t=be(r,"default"),s=be(r,"type"),n=r;if(t)return n.default;if(s){const{type:i}=n,o=te(i);if(o)return qe[o]}return r}function un(r){const{token:e,typeDefinition:t}=r,s=`${vt(e)}-value`,n=cn(r);return{type:n,key:s,name:Ae(s),get defaultValue(){return ln(t)},get hasCustomDefaultValue(){return $(t)!==void 0},reader:hn[n],writer:ze[n]||ze.default}}const qe={get array(){return[]},boolean:!1,number:0,get object(){return{}},string:""},hn={array(r){const e=JSON.parse(r);if(!Array.isArray(e))throw new TypeError(`expected value of type "array" but instead got value "${r}" of type "${$(e)}"`);return e},boolean(r){return!(r=="0"||String(r).toLowerCase()=="false")},number(r){return Number(r.replace(/_/g,""))},object(r){const e=JSON.parse(r);if(e===null||typeof e!="object"||Array.isArray(e))throw new TypeError(`expected value of type "object" but instead got value "${r}" of type "${$(e)}"`);return e},string(r){return r}},ze={default:dn,array:Je,object:Je};function Je(r){return JSON.stringify(r)}function dn(r){return`${r}`}class J{constructor(e){this.context=e}static get shouldLoad(){return!0}static afterLoad(e,t){}get application(){return this.context.application}get scope(){return this.context.scope}get element(){return this.scope.element}get identifier(){return this.scope.identifier}get targets(){return this.scope.targets}get outlets(){return this.scope.outlets}get classes(){return this.scope.classes}get data(){return this.scope.data}initialize(){}connect(){}disconnect(){}dispatch(e,{target:t=this.element,detail:s={},prefix:n=this.identifier,bubbles:i=!0,cancelable:o=!0}={}){const c=n?`${n}:${e}`:e,h=new CustomEvent(c,{detail:s,bubbles:i,cancelable:o});return t.dispatchEvent(h),h}}J.blessings=[Qr,sn,nn,en];J.targets=[];J.outlets=[];J.values={};class fn extends J{static targets=["fileInput","chatMessages","apiKeyModal","apiKeyInput","apiKeyErrorOutput","showApiKeyTemplate","hideApiKeyTemplate","saveApiKeyButton","saveButtonText","savingButtonText","conversationsList","messagesContainer","typingIndicator","filePreviewsContainer","filePreviews","promptInput","askGeminiButton","newChatButton"];static values={csrfToken:String,initialConvId:String,prompt:String,messages:Array,files:Array,isUploading:Boolean,conversations:Array,currentConversationId:String,isTyping:Boolean,apiKey:String,isApiKeyNeeded:Boolean,showApiKey:Boolean,apiKeyError:String,isSavingApiKey:Boolean,professorAvatarUrl:String};messageHasFiles=e=>e.files&&e.files.length>0;messageFileGridClass=e=>e.files.length===1?"grid-cols-1":e.files.length===2?"grid-cols-2":"grid-cols-3";isImageFile=e=>e.type.startsWith("image/");connect(){console.log("Stimulus GeminiAssistantController connected."),this.apiKey=localStorage.getItem("gemini_api_key"),this.apiKey?(this.isApiKeyNeeded=!1,this.apiKeyModalTarget.hidden=!0):(this.isApiKeyNeeded=!0,this.apiKeyModalTarget.hidden=!1),this.initialConvIdValue?this.loadConversation(this.initialConvIdValue):this.fetchConversations()}get prompt(){return this.promptInputValue}set prompt(e){this.promptInputValue=e}get messages(){return this.messagesValue}set messages(e){this.messagesValue=e}get files(){return this.filesValue}set files(e){this.filesValue=e}get isUploading(){return this.isUploadingValue}set isUploading(e){this.isUploadingValue=e}get conversations(){return this.conversationsValue}set conversations(e){this.conversationsValue=e}get currentConversationId(){return this.currentConversationIdValue}set currentConversationId(e){this.currentConversationIdValue=e}get isTyping(){return this.isTypingValue}set isTyping(e){this.isTypingValue=e,this.typingIndicatorTarget.hidden=!e,e&&this.scrollChatToBottom()}get apiKey(){return this.apiKeyValue}set apiKey(e){this.apiKeyValue=e}get isApiKeyNeeded(){return this.isApiKeyNeededValue}set isApiKeyNeeded(e){this.isApiKeyNeededValue=e}get showApiKey(){return this.showApiKeyValue}set showApiKey(e){this.showApiKeyValue=e,this.apiKeyInputTarget.type=e?"text":"password",this.showApiKeyTemplateTarget.hidden=!e,this.hideApiKeyTemplateTarget.hidden=e}get apiKeyError(){return this.apiKeyErrorValue}set apiKeyError(e){this.apiKeyErrorValue=e,this.apiKeyErrorOutputTarget.textContent=e,this.apiKeyErrorOutputTarget.hidden=!e,this.apiKeyInputTarget.classList.toggle("border-red-500",!!e),this.apiKeyInputTarget.classList.toggle("focus:ring-red-500",!!e),this.apiKeyInputTarget.classList.toggle("border-gray-300",!e),this.apiKeyInputTarget.classList.toggle("focus:ring-blue-500",!e)}get isSavingApiKey(){return this.isSavingApiKeyValue}set isSavingApiKey(e){this.isSavingApiKeyValue=e,this.saveApiKeyButtonTarget.disabled=e,this.saveApiKeyButtonTarget.classList.toggle("opacity-50",e),this.saveApiKeyButtonTarget.classList.toggle("cursor-not-allowed",e),this.saveButtonTextTarget.hidden=e,this.savingButtonTextTarget.hidden=!e}async fetchConversations(){try{const e=await fetch("/conversations",{method:"GET",headers:{Accept:"application/json","X-CSRF-TOKEN":this.csrfTokenValue}});if(!e.ok)throw new Error("Failed to fetch conversations");const t=await e.json();if(this.conversations=t.conversations,this.renderConversations(),this.conversations.length>0){const s=this.conversations.find(n=>n.messages_count===0);s?this.loadConversation(s.id):this.loadConversation(this.conversations[0].id)}else this.startNewConversation()}catch(e){console.error("Error fetching conversations:",e)}}async startNewConversation(){const e=this.conversations.find(t=>t.messages_count===0);if(e){this.loadConversation(e.id);return}try{const t=await fetch("/conversations/new",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":this.csrfTokenValue},body:JSON.stringify({title:"New Chat"})});if(!t.ok)throw new Error("Failed to create new conversation");const s=await t.json();this.currentConversationId=s.conversation_id,this.messages=[],this.prompt="",this.files=[],this.hasFileInputTarget&&(this.fileInputTarget.value=""),this.currentConversationId===this.initialConvIdValue&&!this.initialConvIdValue?window.history.pushState({},"","/"):window.history.pushState({},"",`/${this.currentConversationId}`),await this.fetchConversations()}catch(t){console.error("Error starting new conversation:",t)}}async loadConversation(e){console.log(`Attempting to load conversation: ${e}`);try{const t=await fetch(`/conversations/${e}/messages`,{method:"GET",headers:{Accept:"application/json","X-CSRF-TOKEN":this.csrfTokenValue}});if(!t.ok){const n=await t.json();throw console.error("Failed to load conversation messages:",n),new Error(n.message||"Failed to load conversation messages")}const s=await t.json();console.log("Conversation messages loaded:",s),this.messages=s.messages.map(n=>{const i=n.file_ids?n.file_ids.map(o=>({id:o,name:o,type:"application/octet-stream",url:null,sizeText:"N/A",rawFile:null})):[];return{role:n.role,content:n.content,files:i}}),this.currentConversationId=e,this.prompt="",this.files=[],this.hasFileInputTarget&&(this.fileInputTarget.value=""),window.history.pushState({},"",`/${e}`),this.renderMessages()}catch(t){console.error("Error loading conversation:",t)}}loadConversationAndHistory(e){const t=e.currentTarget.dataset.conversationId;this.loadConversation(t),window.history.pushState({},"",`/${t}`)}async deleteConversation(e){const t=e.currentTarget.dataset.conversationId;if(confirm("Are you sure you want to delete this conversation?"))try{if(!(await fetch(`/conversations/${t}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":this.csrfTokenValue}})).ok)throw new Error("Failed to delete conversation");await this.fetchConversations(),this.currentConversationId===t&&(this.currentConversationId=null,this.messages=[],this.prompt="",this.files=[],this.hasFileInputTarget&&(this.fileInputTarget.value=""),this.conversations.length>0?this.loadConversation(this.conversations[0].id):window.location.reload())}catch(s){console.error("Error deleting conversation:",s)}}updatePrompt(e){this.prompt=e.target.value}handlePaste(e){const t=(e.clipboardData||window.clipboardData).items;for(const s of t)if(s.type.indexOf("image")!==-1){const n=s.getAsFile(),i=new File([n],"pasted-image.png",{type:n.type});this.files.push(this.processFile(i))}this.files.length>0&&e.preventDefault(),this.renderFilePreviews()}handleFileSelect(){for(const e of this.fileInputTarget.files)this.files.push(this.processFile(e));this.renderFilePreviews()}removeFile(e){const t=e.currentTarget.dataset.fileId;this.files=this.files.filter(s=>s.id!==t),this.renderFilePreviews()}handleEnter(e){e.shiftKey?this.prompt+=`
`:this.askGemini()}async askGemini(){if(this.prompt.trim()===""&&this.files.length===0)return;this.currentConversationId||await this.startNewConversation();const e=[...this.files],t={role:"user",content:this.prompt,files:e.map(n=>({name:n.name,type:n.type,url:n.url}))};this.messages=[...this.messages,t],this.prompt="",this.files=[],this.hasFileInputTarget&&(this.fileInputTarget.value=""),this.isTyping=!0,this.renderMessages();const s=[];if(e.length>0){this.isUploading=!0;try{for(const n of e){const i=new FormData;i.append("file",n.rawFile);const o=await fetch("/upload-file",{method:"POST",headers:{"X-CSRF-TOKEN":this.csrfTokenValue},body:i});if(!o.ok){const h=await o.json(),l=h.errors?Object.values(h.errors).flat().join(" "):h.message||"File upload failed";throw new Error(l)}const c=await o.json();s.push(c.fileId)}}catch(n){console.error("Error uploading files:",n),this.messages[this.messages.length-1].content=`Sorry, a file upload failed: ${n.message}`,this.isUploading=!1,this.files=[],this.hasFileInputTarget&&(this.fileInputTarget.value=""),this.renderMessages();return}finally{this.isUploading=!1}}try{const n=await fetch("/ask-gemini",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":this.csrfTokenValue},body:JSON.stringify({prompt:t.content,fileIds:s,conversation_id:this.currentConversationId,api_key:this.apiKey})});if(!n.ok){const l=await n.json();throw new Error(l.error||"Network response was not ok")}const i=await n.json(),o=i.output||"Sorry, something went wrong.",c=i.conversation_id;c&&this.currentConversationId!==c&&(this.currentConversationId=c),await this.loadConversation(this.currentConversationId);const h=this.conversations.findIndex(l=>l.id===this.currentConversationId);if(h!==-1&&this.conversations[h].title==="New Chat"&&t.content.trim()!=="")try{const l=await fetch("/conversations/title",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":this.csrfTokenValue},body:JSON.stringify({conversation_id:this.currentConversationId,user_prompt:t.content,api_key:this.apiKey})});if(l.ok){const u=await l.json();u.success&&(this.conversations[h].title=u.new_title)}else console.error("Failed to update conversation title:",await l.json())}catch(l){console.error("Error updating conversation title:",l)}}catch(n){console.error("Error asking Gemini:",n),this.messages[this.messages.length-1].content=`Sorry, an error occurred: ${n.message}`}finally{this.isTyping=!1,this.renderMessages()}}async validateAndSaveApiKey(){console.log("validateAndSaveApiKey function called."),console.log("Current API Key:",this.apiKey),this.isSavingApiKey=!0,this.apiKeyError="",console.log("Attempting to validate API key...");try{const e=await fetch("/validate-api-key",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":this.csrfTokenValue},body:JSON.stringify({api_key:this.apiKey})});if(e.ok)console.log("API Key validated successfully."),localStorage.setItem("gemini_api_key",this.apiKey),this.isApiKeyNeeded=!1,this.apiKeyModalTarget.hidden=!0,await this.fetchConversations(),console.log("API Key modal should now be hidden and conversations fetched.");else{const t=await e.json();console.error("API Key validation failed:",t),this.apiKeyError=t.message||"Invalid API Key. Please check your key and try again."}}catch(e){console.error("Error during API key validation fetch:",e),this.apiKeyError="An error occurred while validating the API key."}finally{this.isSavingApiKey=!1}}toggleApiKeyVisibility(){console.log("toggleApiKeyVisibility called."),this.showApiKey=!this.showApiKey,this.apiKeyError=""}updateApiKey(e){this.apiKey=e.target.value}processFile(e){const t=URL.createObjectURL(e),s=(e.size/1024).toFixed(1);return{id:t,name:e.name,type:e.type,url:e.type.startsWith("image/")?URL.createObjectURL(e):null,sizeText:`${s} KB`,rawFile:e}}scrollChatToBottom(){this.hasChatMessagesTarget&&(this.chatMessagesTarget.scrollTop=this.chatMessagesTarget.scrollHeight)}triggerFileInput(){this.fileInputTarget.click()}get isPromptEmpty(){return this.prompt.trim()===""&&this.files.length===0}renderConversations(){this.conversationsListTarget.innerHTML="";const s=`
            <button data-action="click->gemini-assistant#startNewConversation"
                    data-gemini-assistant-target="newChatButton"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2.5 px-4 rounded-lg text-sm transition-colors duration-200 flex items-center justify-center ${this.currentConversationId===null?"bg-gray-700":""}">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                New Chat
            </button>
        `;this.conversationsListTarget.insertAdjacentHTML("beforeend",s),this.conversations.forEach(n=>{const i=`
                <div class="conversation-item rounded-lg cursor-pointer ${this.currentConversationId===n.id?"bg-gray-700":""}"
                     data-action="click->gemini-assistant#loadConversationAndHistory"
                     data-conversation-id="${n.id}">
                    <div class="flex items-center justify-between p-3">
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-medium text-white truncate">${n.title}</p>
                            <p class="text-xs text-gray-400 mt-1">2 hours ago</p>
                        </div>
                        <button data-action="click->gemini-assistant#deleteConversation" data-conversation-id="${n.id}"
                                class="text-gray-400 hover:text-red-400 p-1 rounded transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                      d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            `;this.conversationsListTarget.insertAdjacentHTML("beforeend",i)})}renderMessages(){this.messagesContainerTarget.innerHTML="";const e=this;this.messages.forEach(t=>{let s="";if(t.role==="user"){let n="";e.messageHasFiles(t)&&(n=`
                        <div class="mb-2 grid gap-2 ${e.messageFileGridClass(t)}">
                            ${t.files.map(i=>`
                                <div>
                                    ${e.isImageFile(i)?`<img src="${i.url}" class="rounded-lg max-h-48 w-full object-cover">`:`
                                        <div class="p-2 rounded-lg bg-blue-500 text-white flex items-center">
                                            <svg class="w-5 h-5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                            </svg>
                                            <span class="text-sm truncate">${i.name}</span>
                                        </div>
                                    `}
                                </div>
                            `).join("")}
                        </div>
                    `),s=`
                    <div class="message-bubble">
                        <div class="flex justify-end mb-4">
                            <div class="flex items-end max-w-xs lg:max-w-md">
                                <div class="bg-blue-600 text-white p-3 rounded-2xl rounded-br-md shadow-lg">
                                    ${n}
                                    ${e.messageHasContent(t)?`<p class="text-sm whitespace-pre-wrap">${t.content}</p>`:""}
                                </div>
                                <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center ml-2 flex-shrink-0">
                                    <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                `}else t.role==="assistant"&&(s=`
                    <div class="message-bubble">
                        <div class="flex justify-start mb-4">
                            <div class="flex items-end max-w-xs lg:max-w-2xl">
                                <div class="w-8 h-8 rounded-full flex items-center justify-center mr-2 flex-shrink-0 overflow-hidden">
                                    <img src="${e.professorAvatarUrlValue}" alt="Professor Avatar" class="w-full h-full object-cover">
                                </div>
                                <div class="bg-white border border-gray-200 p-3 rounded-2xl rounded-bl-md shadow-sm">
                                    <div class="text-sm text-gray-800 whitespace-pre-wrap prose">${e.renderMarkdown(t.content)}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `);this.messagesContainerTarget.insertAdjacentHTML("beforeend",s)}),e.scrollChatToBottom()}messageHasContent=e=>e.content&&e.content.trim()!=="";renderTypingIndicator(){if(this.isTyping){const e=`
                <div class="flex justify-start mb-4" data-gemini-assistant-target="typingIndicator">
                    <div class="flex items-end">
                        <div class="w-8 h-8 rounded-full flex items-center justify-center mr-2 flex-shrink-0 overflow-hidden">
                            <img src="${this.professorAvatarUrlValue}" alt="Professor Avatar" class="w-full h-full object-cover">
                        </div>
                        <div class="bg-white border border-gray-200 p-3 rounded-2xl rounded-bl-md shadow-sm">
                            <div class="typing-indicator">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                        </div>
                    </div>
                </div>
            `;this.messagesContainerTarget.insertAdjacentHTML("beforeend",e)}this.scrollChatToBottom()}renderMarkdown=e=>marked.parse(e);renderFilePreviews(){this.files.length>0?(this.filePreviewsContainerTarget.hidden=!1,this.filePreviewsTarget.innerHTML="",this.files.forEach(e=>{const t=`
                    <div class="file-preview relative bg-gray-50 border border-gray-200 rounded-lg p-3">
                        <div class="flex items-center">
                            <div class="w-10 h-10 flex-shrink-0 mr-3">
                                ${this.isImageFile(e)?`<img src="${e.url}" class="w-full h-full rounded-md object-cover">`:`
                                    <div class="w-full h-full rounded-md bg-blue-100 flex items-center justify-center">
                                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                        </svg>
                                    </div>
                                `}
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-sm font-medium text-gray-900 truncate">${e.name}</p>
                                <p class="text-xs text-gray-500">${e.sizeText}</p>
                            </div>
                        </div>
                        <button data-action="click->gemini-assistant#removeFile" data-file-id="${e.id}"
                                class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                `;this.filePreviewsTarget.insertAdjacentHTML("beforeend",t)})):this.filePreviewsContainerTarget.hidden=!0}}const pn=Gr.start();pn.register("gemini-assistant",fn);
